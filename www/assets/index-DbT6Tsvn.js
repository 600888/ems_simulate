const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./Device-Bzwx1kbI.js","./element-plus-Drht8FjI.js","./vendor-D7VVe7DO.js","./element-plus-C81TiDJ7.css","./Device.vue_vue_type_style_index_0_scoped_83bfaf52_lang-C1neuMVR.js","./Device-D6awjG9A.css"])))=>i.map(i=>d[i]);
import{r as V,U as A,o as O,y as $,v as y,A as G,M as t,E as l,u as m,a0 as ne,t as I,J as E,H as X,K as W,L as K,G as ee,Z as Ce,F as ce,O as pe,av as Y,c as J,a3 as Se,S as Ge,b3 as Le,b4 as Me,b5 as qe,b6 as He,at as ze,b7 as je}from"./vendor-D7VVe7DO.js";import{E as se,c as ae,s as Ee,m as $e,a as We,b as Z,p as me,f as ve,d as ye,e as Je,g as Ze,h as Qe,i as Ye,j as Xe,k as fe,v as et,l as tt,n as _e,o as ot,q as lt,r as be,t as ie,u as he,w as Ue,x as nt,y as at,z as rt,A as st,B as it,C as dt,D as ut,F as ct,G as pt,H as Re,I as Te,J as Pe,K as B,L as mt,M as Ne,N as De,O as vt,P as ft,Q as _t,R as gt,S as yt,T as bt,U as ht,V as Vt}from"./element-plus-Drht8FjI.js";import{_ as H,r as R,i as Ve,g as wt}from"./Device.vue_vue_type_style_index_0_scoped_83bfaf52_lang-C1neuMVR.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))d(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&d(a)}).observe(document,{childList:!0,subtree:!0});function o(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function d(s){if(s.ep)return;s.ep=!0;const i=o(s);fetch(s.href,i)}})();const kt="modulepreload",Ct=function(e,n){return new URL(e,n).href},Ie={},Be=function(n,o,d){let s=Promise.resolve();if(o&&o.length>0){const a=document.getElementsByTagName("link"),v=document.querySelector("meta[property=csp-nonce]"),c=v?.nonce||v?.getAttribute("nonce");s=Promise.allSettled(o.map(r=>{if(r=Ct(r,d),r in Ie)return;Ie[r]=!0;const h=r.endsWith(".css"),w=h?'[rel="stylesheet"]':"";if(!!d)for(let p=a.length-1;p>=0;p--){const b=a[p];if(b.href===r&&(!h||b.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${w}`))return;const g=document.createElement("link");if(g.rel=h?"stylesheet":kt,h||(g.as="script"),g.crossOrigin="",g.href=r,c&&g.setAttribute("nonce",c),document.head.appendChild(g),h)return new Promise((p,b)=>{g.addEventListener("load",p),g.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${r}`)))})}))}function i(a){const v=new Event("vite:preloadError",{cancelable:!0});if(v.payload=a,window.dispatchEvent(v),!v.defaultPrevented)throw a}return s.then(a=>{for(const v of a||[])v.status==="rejected"&&i(v.reason);return n().catch(i)})},Ae="sidebar-theme",j=V(localStorage.getItem(Ae)||"light"),le=()=>{j.value=j.value==="light"?"dark":"light"};A(j,e=>{localStorage.setItem(Ae,e),document.body.className=`theme-${e}`},{immediate:!0});const Et={key:0,class:"sidebar-header"},$t={class:"logo-box"},Dt={key:1,class:"sidebar-header-collapsed"},It={class:"logo-box-collapsed"},xt=O({__name:"SideNavHeader",props:{isCollapse:{type:Boolean}},setup(e){return(n,o)=>{const d=se;return e.isCollapse?(y(),$("div",Dt,[G("div",It,[t(d,{class:"logo-icon"},{default:l(()=>[t(m(ae))]),_:1})]),G("div",{class:"theme-toggle-collapsed",onClick:o[1]||(o[1]=ne((...s)=>m(le)&&m(le)(...s),["stop"]))},[t(d,{class:"theme-icon"},{default:l(()=>[m(j)==="dark"?(y(),I(m(Ee),{key:0})):(y(),I(m($e),{key:1}))]),_:1})])])):(y(),$("div",Et,[G("div",$t,[t(d,{class:"logo-icon"},{default:l(()=>[t(m(ae))]),_:1}),o[2]||(o[2]=G("span",{class:"logo-text"},"设备列表",-1)),G("div",{class:"theme-toggle-wrapper",onClick:o[0]||(o[0]=ne((...s)=>m(le)&&m(le)(...s),["stop"]))},[t(d,{class:"theme-icon"},{default:l(()=>[m(j)==="dark"?(y(),I(m(Ee),{key:0})):(y(),I(m($e),{key:1}))]),_:1})])])]))}}}),St=H(xt,[["__scopeId","data-v-9ffec8b7"]]),Gt={class:"action-buttons-container"},Ut={key:0,class:"action-buttons"},Rt={key:1,class:"add-device-btn-collapse"},Tt=O({__name:"SideNavActions",props:{isCollapse:{type:Boolean}},emits:["add-device","add-group"],setup(e){return(n,o)=>{const d=Z,s=We,i=ye;return y(),$("div",Gt,[e.isCollapse?(y(),$("div",Rt,[t(i,{content:"添加设备",placement:"right"},{default:l(()=>[t(d,{type:"primary",circle:"",onClick:o[2]||(o[2]=a=>n.$emit("add-device")),icon:m(me)},null,8,["icon"])]),_:1}),t(i,{content:"添加分组",placement:"right"},{default:l(()=>[t(d,{type:"success",circle:"",onClick:o[3]||(o[3]=a=>n.$emit("add-group")),icon:m(ve)},null,8,["icon"])]),_:1})])):(y(),$("div",Ut,[t(s,null,{default:l(()=>[t(d,{type:"primary",onClick:o[0]||(o[0]=a=>n.$emit("add-device")),icon:m(me)},{default:l(()=>[...o[4]||(o[4]=[E(" 添加设备 ",-1)])]),_:1},8,["icon"]),t(d,{type:"success",onClick:o[1]||(o[1]=a=>n.$emit("add-group")),icon:m(ve)},{default:l(()=>[...o[5]||(o[5]=[E(" 添加分组 ",-1)])]),_:1},8,["icon"])]),_:1})]))])}}}),Pt=H(Tt,[["__scopeId","data-v-9eb50b71"]]),Nt={class:"node-label"},Bt=O({__name:"SideNavTree",props:{treeData:{},treeProps:{},expandedKeys:{},currentNodeKey:{},isCollapse:{type:Boolean}},emits:["node-click","group-command","edit-device","delete-device"],setup(e){const n=e,o=V(),d=()=>{Ce(()=>{o.value&&n.expandedKeys.forEach(i=>{const a=o.value?.getNode(i);a&&(a.expanded=!0)})})},s=()=>{Ce(()=>{o.value&&n.currentNodeKey&&o.value.setCurrentKey(n.currentNodeKey)})};return A(()=>n.expandedKeys,d,{deep:!0}),A(()=>n.treeData,()=>{d(),s()},{deep:!0}),A(()=>n.currentNodeKey,s),(i,a)=>{const v=se,c=ye,r=Z,h=Xe,w=Ye,D=Ze;return y(),I(m(ot),{ref_key:"treeRef",ref:o,data:e.treeData,props:e.treeProps,"node-key":"nodeKey","default-expanded-keys":e.expandedKeys,"current-node-key":e.currentNodeKey,"expand-on-click-node":!1,"highlight-current":"",onNodeClick:a[1]||(a[1]=g=>i.$emit("node-click",g)),class:"device-tree"},{default:l(({node:g,data:p})=>[G("div",{class:ee(["tree-node-content",{"is-group":p.isGroup}])},[t(c,{content:g.label,placement:"right",disabled:!e.isCollapse},{default:l(()=>[t(v,{class:"node-icon"},{default:l(()=>[p.isGroup?(y(),I(m(Je),{key:0})):(y(),I(m(ae),{key:1}))]),_:2},1024)]),_:2},1032,["content","disabled"]),G("span",Nt,W(g.label),1),e.isCollapse?X("",!0):(y(),$("div",{key:0,class:"node-actions",onClick:a[0]||(a[0]=ne(()=>{},["stop"]))},[p.isGroup?(y(),I(D,{key:0,trigger:"click",onCommand:b=>i.$emit("group-command",b,p)},{dropdown:l(()=>[t(w,null,{default:l(()=>[t(h,{command:"edit",icon:m(fe)},{default:l(()=>[...a[2]||(a[2]=[E("编辑",-1)])]),_:1},8,["icon"]),t(h,{command:"addDevice",icon:m(me)},{default:l(()=>[...a[3]||(a[3]=[E("添加设备",-1)])]),_:1},8,["icon"]),t(h,{command:"addSubGroup",icon:m(ve)},{default:l(()=>[...a[4]||(a[4]=[E("添加子分组",-1)])]),_:1},8,["icon"]),t(h,{command:"startAll",icon:m(et)},{default:l(()=>[...a[5]||(a[5]=[E("启动全部",-1)])]),_:1},8,["icon"]),t(h,{command:"stopAll",icon:m(tt)},{default:l(()=>[...a[6]||(a[6]=[E("停止全部",-1)])]),_:1},8,["icon"]),t(h,{command:"delete",icon:m(_e),divided:""},{default:l(()=>[...a[7]||(a[7]=[E("删除",-1)])]),_:1},8,["icon"])]),_:1})]),default:l(()=>[t(r,{link:"",size:"small",icon:m(Qe)},null,8,["icon"])]),_:1},8,["onCommand"])):(y(),$(K,{key:1},[t(r,{link:"",size:"small",icon:m(fe),onClick:b=>i.$emit("edit-device",p)},null,8,["icon","onClick"]),t(r,{link:"",size:"small",icon:m(_e),onClick:b=>i.$emit("delete-device",p)},null,8,["icon","onClick"])],64))]))],2)]),_:1},8,["data","props","default-expanded-keys","current-node-key"])}}}),At=H(Bt,[["__scopeId","data-v-c9679cbb"]]),Ot={key:0,class:"ungrouped-section"},Ft={class:"ungrouped-list"},Kt=["onClick"],Lt=O({__name:"SideNavUngrouped",props:{ungroupedDevices:{},expanded:{type:Boolean},currentDeviceName:{},isCollapse:{type:Boolean}},emits:["toggle","device-click","edit-device","delete-device"],setup(e){return(n,o)=>{const d=se,s=ye,i=Z;return e.ungroupedDevices.length>0?(y(),$("div",Ot,[G("div",{class:"ungrouped-header",onClick:o[0]||(o[0]=a=>n.$emit("toggle"))},[t(d,null,{default:l(()=>[t(m(lt),{class:ee({"is-expanded":e.expanded})},null,8,["class"])]),_:1}),G("span",null,"未分组设备 ("+W(e.ungroupedDevices.length)+")",1)]),ce(G("div",Ft,[(y(!0),$(K,null,Y(e.ungroupedDevices,a=>(y(),$("div",{key:a.id,class:ee(["ungrouped-item",{"is-active":e.currentDeviceName===a.name}]),onClick:v=>n.$emit("device-click",a)},[t(s,{content:a.name,placement:"right",disabled:!e.isCollapse},{default:l(()=>[t(d,null,{default:l(()=>[t(m(ae))]),_:1})]),_:1},8,["content","disabled"]),G("span",null,W(a.name),1),e.isCollapse?X("",!0):(y(),$("div",{key:0,class:"node-actions",onClick:o[1]||(o[1]=ne(()=>{},["stop"]))},[t(i,{link:"",size:"small",icon:m(fe),onClick:v=>n.$emit("edit-device",a.name)},null,8,["icon","onClick"]),t(i,{link:"",size:"small",icon:m(_e),onClick:v=>n.$emit("delete-device",a.name)},null,8,["icon","onClick"])]))],10,Kt))),128))],512),[[pe,e.expanded]])])):X("",!0)}}}),Mt=H(Lt,[["__scopeId","data-v-b15ab307"]]),qt={class:"device-form-basic"},Ht=O({__name:"DeviceFormBasic",props:{modelValue:{},groupOptions:{}},setup(e){return(n,o)=>{const d=be,s=he,i=ie,a=Ue;return y(),$("div",qt,[t(d,{"content-position":"left"},{default:l(()=>[...o[3]||(o[3]=[E("基本信息",-1)])]),_:1}),t(i,{label:"设备编码",prop:"code"},{default:l(()=>[t(s,{modelValue:e.modelValue.code,"onUpdate:modelValue":o[0]||(o[0]=v=>e.modelValue.code=v),placeholder:"请输入设备编码，如 PCS1"},null,8,["modelValue"])]),_:1}),t(i,{label:"设备名称",prop:"name"},{default:l(()=>[t(s,{modelValue:e.modelValue.name,"onUpdate:modelValue":o[1]||(o[1]=v=>e.modelValue.name=v),placeholder:"请输入设备名称"},null,8,["modelValue"])]),_:1}),t(i,{label:"所属设备组"},{default:l(()=>[t(a,{modelValue:e.modelValue.group_id,"onUpdate:modelValue":o[2]||(o[2]=v=>e.modelValue.group_id=v),data:e.groupOptions,props:{label:"name",value:"id",children:"children"},placeholder:"选择设备组（可选，不选则为未分组）","check-strictly":"",clearable:"",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1})])}}}),zt=H(Ht,[["__scopeId","data-v-f4f64863"]]),jt={class:"device-form-config"},Wt=O({__name:"DeviceFormConfig",props:{modelValue:{},mediaType:{},protocols:{},serialPorts:{}},emits:["update:mediaType"],setup(e,{emit:n}){const o=e,d=n,s=V(o.mediaType);A(()=>o.mediaType,c=>s.value=c);const i=J(()=>o.protocols.filter(c=>c.conn_types.includes(o.modelValue.conn_type))),a=[1200,2400,4800,9600,19200,38400,57600,115200],v=c=>{d("update:mediaType",c),c==="serial"?o.modelValue.conn_type=3:o.modelValue.conn_type=2};return(c,r)=>{const h=be,w=at,D=nt,g=ie,p=st,b=rt,S=he,z=it,F=ut,P=dt;return y(),$("div",jt,[t(h,{"content-position":"left"},{default:l(()=>[...r[13]||(r[13]=[E("通迅配置",-1)])]),_:1}),t(g,{label:"通讯介质"},{default:l(()=>[t(D,{modelValue:s.value,"onUpdate:modelValue":r[0]||(r[0]=_=>s.value=_),onChange:v},{default:l(()=>[t(w,{value:"serial"},{default:l(()=>[...r[14]||(r[14]=[E("串口",-1)])]),_:1}),t(w,{value:"network"},{default:l(()=>[...r[15]||(r[15]=[E("网络",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"连接模式",prop:"conn_type"},{default:l(()=>[s.value==="serial"?(y(),I(D,{key:0,modelValue:e.modelValue.conn_type,"onUpdate:modelValue":r[1]||(r[1]=_=>e.modelValue.conn_type=_)},{default:l(()=>[t(w,{value:0},{default:l(()=>[...r[16]||(r[16]=[E("主站（主动轮询）",-1)])]),_:1}),t(w,{value:3},{default:l(()=>[...r[17]||(r[17]=[E("从站（被动响应）",-1)])]),_:1})]),_:1},8,["modelValue"])):(y(),I(D,{key:1,modelValue:e.modelValue.conn_type,"onUpdate:modelValue":r[2]||(r[2]=_=>e.modelValue.conn_type=_)},{default:l(()=>[t(w,{value:1},{default:l(()=>[...r[18]||(r[18]=[E("TCP客户端",-1)])]),_:1}),t(w,{value:2},{default:l(()=>[...r[19]||(r[19]=[E("TCP服务端",-1)])]),_:1})]),_:1},8,["modelValue"]))]),_:1}),t(g,{label:"通讯协议",prop:"protocol_type"},{default:l(()=>[t(b,{modelValue:e.modelValue.protocol_type,"onUpdate:modelValue":r[3]||(r[3]=_=>e.modelValue.protocol_type=_),style:{width:"100%"}},{default:l(()=>[(y(!0),$(K,null,Y(i.value,_=>(y(),I(p,{key:_.value,label:_.label,value:_.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s.value==="network"?(y(),$(K,{key:0},[t(g,{label:"IP地址",prop:"ip"},{default:l(()=>[t(S,{modelValue:e.modelValue.ip,"onUpdate:modelValue":r[4]||(r[4]=_=>e.modelValue.ip=_),placeholder:"0.0.0.0 (服务端监听所有IP)"},null,8,["modelValue"])]),_:1}),t(g,{label:"端口",prop:"port"},{default:l(()=>[t(z,{modelValue:e.modelValue.port,"onUpdate:modelValue":r[5]||(r[5]=_=>e.modelValue.port=_),min:1,max:65535,style:{width:"100%"}},null,8,["modelValue"])]),_:1})],64)):X("",!0),s.value==="serial"?(y(),$(K,{key:1},[t(g,{label:"串口号",prop:"com_port"},{default:l(()=>[t(b,{modelValue:e.modelValue.com_port,"onUpdate:modelValue":r[6]||(r[6]=_=>e.modelValue.com_port=_),filterable:"","allow-create":"",placeholder:"选择或输入串口",style:{width:"100%"}},{default:l(()=>[(y(!0),$(K,null,Y(e.serialPorts,_=>(y(),I(p,{key:_.device,label:`${_.device} (${_.description})`,value:_.device},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(g,{label:"波特率",prop:"baud_rate"},{default:l(()=>[t(b,{modelValue:e.modelValue.baud_rate,"onUpdate:modelValue":r[7]||(r[7]=_=>e.modelValue.baud_rate=_),style:{width:"100%"}},{default:l(()=>[(y(),$(K,null,Y(a,_=>t(p,{key:_,label:_,value:_},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(P,{gutter:20},{default:l(()=>[t(F,{span:8},{default:l(()=>[t(g,{label:"数据位",prop:"data_bits"},{default:l(()=>[t(b,{modelValue:e.modelValue.data_bits,"onUpdate:modelValue":r[8]||(r[8]=_=>e.modelValue.data_bits=_)},{default:l(()=>[t(p,{label:7,value:7}),t(p,{label:8,value:8})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(F,{span:8},{default:l(()=>[t(g,{label:"停止位",prop:"stop_bits"},{default:l(()=>[t(b,{modelValue:e.modelValue.stop_bits,"onUpdate:modelValue":r[9]||(r[9]=_=>e.modelValue.stop_bits=_)},{default:l(()=>[t(p,{label:1,value:1}),t(p,{label:2,value:2})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(F,{span:8},{default:l(()=>[t(g,{label:"校验",prop:"parity"},{default:l(()=>[t(b,{modelValue:e.modelValue.parity,"onUpdate:modelValue":r[10]||(r[10]=_=>e.modelValue.parity=_)},{default:l(()=>[t(p,{label:"无",value:"N"}),t(p,{label:"奇",value:"O"}),t(p,{label:"偶",value:"E"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})],64)):X("",!0),e.modelValue.protocol_type===3?(y(),I(g,{key:2,label:"电表地址",prop:"rtu_addr"},{default:l(()=>[t(S,{modelValue:e.modelValue.rtu_addr,"onUpdate:modelValue":r[11]||(r[11]=_=>e.modelValue.rtu_addr=_),placeholder:"DLT645 电表 12 位地址"},null,8,["modelValue"])]),_:1})):(y(),I(g,{key:3,label:"从机地址",prop:"rtu_addr"},{default:l(()=>[t(S,{modelValue:e.modelValue.rtu_addr,"onUpdate:modelValue":r[12]||(r[12]=_=>e.modelValue.rtu_addr=_),placeholder:"Modbus 从机地址 (通常为 1)"},null,8,["modelValue"])]),_:1}))])}}}),Jt={class:"device-form-points"},Zt=O({__name:"DeviceFormPoints",emits:["file-change"],setup(e,{expose:n,emit:o}){const d=V(),s=o,i=v=>(s("file-change",v.file),Promise.resolve());return n({clearFiles:()=>{d.value?.clearFiles()}}),(v,c)=>{const r=be,h=Z,w=ct,D=ie;return y(),$("div",Jt,[t(r,{"content-position":"left"},{default:l(()=>[...c[0]||(c[0]=[E("点表导入",-1)])]),_:1}),t(D,{label:"测点表格"},{default:l(()=>[t(w,{ref_key:"uploadRef",ref:d,action:"#","auto-upload":!0,limit:1,"http-request":i,accept:".xlsx,.xls"},{trigger:l(()=>[t(h,{type:"success",plain:"",icon:m(pt)},{default:l(()=>[...c[1]||(c[1]=[E("选择 Excel 文件",-1)])]),_:1},8,["icon"])]),tip:l(()=>[...c[2]||(c[2]=[G("div",{class:"el-upload__tip"}," 支持 .xlsx 格式，包含遥测/遥信/遥控/遥调 四个 sheet ",-1)])]),_:1},512)]),_:1})])}}}),Qt=H(Zt,[["__scopeId","data-v-f3841c7c"]]);async function Yt(){try{return await R("/channel/protocols","get",null)}catch(e){throw console.error("Error fetching protocol config:",e),e}}async function Xt(){try{return await R("/channel/serial_ports","get",null)}catch(e){throw console.error("Error fetching serial ports:",e),e}}async function eo(e){try{return await R("/channel/create","post",e)}catch(n){throw console.error("Error creating channel:",n),n}}async function to(e,n){try{const o=new FormData;return o.append("channel_id",e.toString()),o.append("file",n),(await Ve.post("/channel/import_points",o,{headers:{"Content-Type":"multipart/form-data"}})).data.data}catch(o){throw console.error("Error importing points:",o),o}}async function oo(e){try{return(await Ve.delete(`/channel/${e}`)).data.data}catch(n){throw console.error("Error deleting channel:",n),n}}async function xe(){try{return await R("/channel/list","get",null)}catch(e){throw console.error("Error fetching channel list:",e),e}}async function lo(e){try{return await R(`/channel/${e}`,"get",null)}catch(n){throw console.error("Error fetching channel:",n),n}}async function no(e,n){try{return await R(`/channel/${e}`,"put",n)}catch(o){throw console.error("Error updating channel:",o),o}}async function ao(e){try{return await R(`/channel/reload_config/${e}`,"post",null)}catch(n){throw console.error("Error reloading device config:",n),n}}async function ro(){try{return await R("/api/device-groups/tree","get",null)}catch(e){throw console.error("Error fetching device group tree:",e),e}}async function so(){try{return await R("/api/device-groups/","get",null)}catch(e){throw console.error("Error fetching device groups:",e),e}}async function io(e){try{return await R(`/api/device-groups/${e}`,"get",null)}catch(n){throw console.error("Error fetching device group:",n),n}}async function uo(e){try{return await R("/api/device-groups/","post",e)}catch(n){throw console.error("Error creating device group:",n),n}}async function co(e,n){try{return await R(`/api/device-groups/${e}`,"put",n),!0}catch(o){throw console.error("Error updating device group:",o),o}}async function po(e,n=!1){try{return await Ve.delete(`/api/device-groups/${e}`,{params:{cascade:n}}),!0}catch(o){throw console.error("Error deleting device group:",o),o}}async function mo(e,n){try{return await R(`/api/device-groups/${e}/batch-operation`,"post",{group_id:e,operation:n})}catch(o){throw console.error("Error batch operating devices:",o),o}}const vo={class:"dialog-footer"},fo=O({__name:"AddDeviceDialog",props:{visible:{type:Boolean},channelId:{},initialGroupId:{}},emits:["update:visible","success","close"],setup(e,{emit:n}){const o=e,d=n,s=V(),i=V(),a=V(!1),v=V(""),c=V("network"),r=V(null),h=V([]),w=V([]),D=V([]),g=J(()=>!!o.channelId),p=J({get:()=>o.visible,set:x=>d("update:visible",x)}),b=Se({code:"",name:"",protocol_type:1,conn_type:2,ip:"0.0.0.0",port:502,com_port:"",baud_rate:9600,data_bits:8,stop_bits:1,parity:"N",rtu_addr:"1",group_id:null}),S={code:[{required:!0,message:"请输入编码",trigger:"blur"}],name:[{required:!0,message:"请输入名称",trigger:"blur"}],port:[{required:!0,message:"请输入端口",trigger:"blur"}]};Ge(async()=>{try{const x=await Yt();D.value=x.protocols,await F()}catch(x){console.error("加载系统配置失败",x)}}),A(()=>o.visible,async x=>{x&&(await z(),g.value||(_(),o.initialGroupId&&(b.group_id=o.initialGroupId)))}),A(()=>[o.visible,o.channelId],async([x,k])=>{x&&k&&await P(k)},{immediate:!0});const z=async()=>{h.value=await so()},F=async()=>{w.value=await Xt()},P=async x=>{try{const k=await lo(x);if(!k)return;Object.assign(b,k),v.value=k.name||"",c.value=k.conn_type===0||k.conn_type===3?"serial":"network"}catch(k){console.error("加载通道失败",k)}},_=()=>{Object.assign(b,{code:"",name:"",protocol_type:1,conn_type:2,ip:"0.0.0.0",port:502,com_port:"COM1",baud_rate:9600,data_bits:8,stop_bits:1,parity:"N",rtu_addr:"1",group_id:null}),r.value=null,i.value?.clearFiles()},U=async()=>{s.value&&await s.value.validate(async x=>{if(x){a.value=!0;try{let k;g.value&&o.channelId?(await no(o.channelId,b),k=o.channelId,await ao(o.channelId),B.success("更新成功，配置已重新加载")):(k=(await eo(b)).channel_id,B.success("创建成功")),r.value&&await to(k,r.value),d("success",b.name,g.value,v.value),p.value=!1}catch(k){B.error(k.message||"操作失败")}finally{a.value=!1}}})},te=()=>{p.value=!1,d("close")};return(x,k)=>{const oe=Re,Q=Z,ue=Pe;return y(),I(ue,{modelValue:p.value,"onUpdate:modelValue":k[2]||(k[2]=L=>p.value=L),title:g.value?"编辑设备":"添加设备",width:"640px","close-on-click-modal":!1,onClose:te,class:"modern-dialog"},{footer:l(()=>[G("div",vo,[t(Q,{onClick:te,round:""},{default:l(()=>[...k[3]||(k[3]=[E("取消",-1)])]),_:1}),t(Q,{type:"primary",loading:a.value,onClick:U,round:"",class:"submit-btn",icon:m(Te)},{default:l(()=>[E(W(g.value?"保存修改":"确认添加"),1)]),_:1},8,["loading","icon"])])]),default:l(()=>[t(oe,{ref_key:"formRef",ref:s,model:b,rules:S,"label-width":"110px","label-position":"right"},{default:l(()=>[t(zt,{"model-value":b,"group-options":h.value},null,8,["model-value","group-options"]),t(Wt,{"model-value":b,"media-type":c.value,"onUpdate:mediaType":k[0]||(k[0]=L=>c.value=L),protocols:D.value,"serial-ports":w.value},null,8,["model-value","media-type","protocols","serial-ports"]),t(Qt,{ref_key:"uploadCompRef",ref:i,onFileChange:k[1]||(k[1]=L=>r.value=L)},null,512)]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),_o={class:"dialog-footer"},go=O({__name:"AddDeviceGroupDialog",props:{visible:{type:Boolean},groupId:{},parentOptions:{}},emits:["update:visible","success","close"],setup(e,{emit:n}){const o=e,d=n,s=V(),i=V(!1),a=J(()=>!!o.groupId),v=J({get:()=>o.visible,set:g=>d("update:visible",g)}),c=Se({code:"",name:"",parent_id:null,description:""}),r={code:[{required:!0,message:"请输入编码",trigger:"blur"},{min:1,max:32,message:"1-32字符",trigger:"blur"},{pattern:/^[a-zA-Z0-9_]+$/,message:"仅限字母/数字/下划线",trigger:"blur"}],name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:1,max:64,message:"1-64字符",trigger:"blur"}]};A(()=>[o.visible,o.groupId],async([g,p])=>{if(g&&p)try{const b=await io(p);b&&Object.assign(c,{code:b.code,name:b.name,parent_id:b.parent_id,description:b.description||""})}catch{}},{immediate:!0});const h=()=>{v.value=!1,w(),d("close")},w=()=>{Object.assign(c,{code:"",name:"",parent_id:null,description:""}),s.value?.resetFields()},D=async()=>{s.value&&await s.value.validate(async g=>{if(g){i.value=!0;try{a.value&&o.groupId?(await co(o.groupId,{name:c.name,parent_id:c.parent_id,description:c.description}),B.success("更新成功")):(await uo(c),B.success("创建成功")),d("success"),h()}catch(p){B.error(p.message||"操作失败")}finally{i.value=!1}}})};return(g,p)=>{const b=he,S=ie,z=Ue,F=Re,P=Z,_=Pe;return y(),I(_,{modelValue:v.value,"onUpdate:modelValue":p[4]||(p[4]=U=>v.value=U),title:a.value?"编辑设备组":"添加设备组",width:"520px","close-on-click-modal":!1,onClose:h,class:"modern-dialog"},{footer:l(()=>[G("div",_o,[t(P,{onClick:h,round:""},{default:l(()=>[...p[5]||(p[5]=[E("取消",-1)])]),_:1}),t(P,{type:"primary",loading:i.value,onClick:D,round:"",icon:m(Te)},{default:l(()=>[E(W(a.value?"保存修改":"确认添加"),1)]),_:1},8,["loading","icon"])])]),default:l(()=>[t(F,{ref_key:"formRef",ref:s,model:c,rules:r,"label-width":"100px","label-position":"right"},{default:l(()=>[t(S,{label:"组编码",prop:"code"},{default:l(()=>[t(b,{modelValue:c.code,"onUpdate:modelValue":p[0]||(p[0]=U=>c.code=U),placeholder:"请输入设备组编码，如 GROUP1",disabled:a.value},null,8,["modelValue","disabled"])]),_:1}),t(S,{label:"组名称",prop:"name"},{default:l(()=>[t(b,{modelValue:c.name,"onUpdate:modelValue":p[1]||(p[1]=U=>c.name=U),placeholder:"请输入设备组名称"},null,8,["modelValue"])]),_:1}),t(S,{label:"父级设备组",prop:"parent_id"},{default:l(()=>[t(z,{modelValue:c.parent_id,"onUpdate:modelValue":p[2]||(p[2]=U=>c.parent_id=U),data:e.parentOptions,props:{label:"name",value:"id",children:"children"},placeholder:"选择父级设备组（可选）","check-strictly":"",clearable:"",style:{width:"100%"}},null,8,["modelValue","data"])]),_:1}),t(S,{label:"描述",prop:"description"},{default:l(()=>[t(b,{modelValue:c.description,"onUpdate:modelValue":p[3]||(p[3]=U=>c.description=U),type:"textarea",rows:3,placeholder:"请输入设备组描述（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),T=V(!1),re=Le({history:Me(),routes:[]});let ge=!1;ge||await yo();async function yo(){if(!ge)try{const e=await wt();for(const n of e){const o={path:`/device/${n}`,name:n,meta:{title:n},component:()=>Be(()=>import("./Device-Bzwx1kbI.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)};re.addRoute(o)}ge=!0}catch(e){console.error("Error adding dynamic routes:",e)}}const bo=O({__name:"SideBar",setup(e){const n=qe();V();const o=V(!1),d=V(!1),s=V(null),i=V(null),a=V(null),v=V([]),c=V([]),r=V([]),h=V(""),w=V(""),D=V(!0),g={children:"children",label:"label"},p=J(()=>{const u=f=>f.filter(C=>C.isGroup).map(C=>({id:C.id,code:"",name:C.name,parent_id:null,description:null,status:0,enable:!0,created_at:null,updated_at:null,children:C.children?u(C.children):[],devices:[]}));return u(v.value)}),b=u=>u.map(f=>{const C=[];return f.children?.length&&C.push(...b(f.children)),f.devices?.length&&C.push(...f.devices.map(N=>({nodeKey:`device-${N.id}`,label:N.name,isGroup:!1,id:N.id,name:N.name,groupId:f.id}))),{nodeKey:`group-${f.id}`,label:f.name,isGroup:!0,id:f.id,name:f.name,children:C}}),S=async()=>{try{const u=await ro();v.value=b(u.groups||[]),c.value=u.ungrouped||[],w.value&&(h.value=`device-${w.value}`)}catch(u){B.error("获取设备组失败: "+u.message)}},z=u=>{u.isGroup||P(u.name)},F=u=>P(u.name),P=u=>{w.value=u,h.value=`device-${u}`;const f=`/device/${u}`;localStorage.setItem("activeRoute",f),n.push(f)},_=()=>{s.value=null,a.value=null,o.value=!0},U=u=>{i.value=null,a.value=u||null,d.value=!0},te=async(u,f)=>{({edit:()=>{i.value=f.id,d.value=!0},addDevice:()=>{a.value=f.id,o.value=!0},addSubGroup:()=>U(f.id),startAll:()=>x(f.id,"start"),stopAll:()=>x(f.id,"stop"),delete:()=>k(f)})[u]?.()},x=async(u,f)=>{try{await mo(u,f),B.success(`${f==="start"?"启动":"停止"}成功`)}catch(C){B.error("操作失败: "+C.message)}},k=async u=>{try{await De.confirm(`确定删除组 "${u.name}"？`,"提示",{type:"warning"}),await po(u.id,!1),B.success("成功"),await S()}catch{}},oe=u=>Q(u.name),Q=async u=>{const f=(await xe()).find(C=>C.name===u);f&&(s.value=f.id,o.value=!0)},ue=u=>L(u.name),L=async u=>{try{await De.confirm(`确定删除 "${u}"？`,"提示",{type:"warning"});const f=(await xe()).find(C=>C.name===u);f&&(await oo(f.id),window.location.reload())}catch{}},Oe=async(u,f,C)=>{f&&C&&C!==u&&re.removeRoute(C),re.addRoute({path:`/device/${u}`,name:u,component:()=>Be(()=>import("./Device-Bzwx1kbI.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)}),await S();let N=!1;const M=we=>{for(const q of we)if(q.isGroup&&q.children){if(q.children.some(ke=>!ke.isGroup&&ke.name===u)){r.value.includes(q.nodeKey)||r.value.push(q.nodeKey),N=!0;return}if(M(q.children),N)return}};M(v.value),N||c.value.some(q=>q.name===u)&&(D.value=!0),P(u)},Fe=()=>S(),Ke=()=>{D.value=!D.value};return Ge(()=>{S();const u=localStorage.getItem("isCollapse");u&&(T.value=u==="true")}),A(()=>n.currentRoute.value.path,u=>{if(u.startsWith("/device/")){const f=u.split("/").pop()||"";w.value=f,h.value=`device-${f}`}},{immediate:!0}),(u,f)=>{const C=Ne,N=mt;return y(),$(K,null,[t(N,{class:ee(["sidebar",[`sidebar-theme-${m(j)}`,{"sidebar-collapsed":m(T)}]])},{default:l(()=>[t(C,null,{default:l(()=>[t(St,{"is-collapse":m(T)},null,8,["is-collapse"]),t(Pt,{"is-collapse":m(T),onAddDevice:_,onAddGroup:f[0]||(f[0]=()=>U())},null,8,["is-collapse"]),t(At,{"tree-data":v.value,"tree-props":g,"expanded-keys":r.value,"current-node-key":h.value,"is-collapse":m(T),onNodeClick:z,onGroupCommand:te,onEditDevice:oe,onDeleteDevice:ue},null,8,["tree-data","expanded-keys","current-node-key","is-collapse"]),t(Mt,{"ungrouped-devices":c.value,expanded:D.value,"current-device-name":w.value,"is-collapse":m(T),onToggle:Ke,onDeviceClick:F,onEditDevice:Q,onDeleteDevice:L},null,8,["ungrouped-devices","expanded","current-device-name","is-collapse"])]),_:1})]),_:1},8,["class"]),t(fo,{visible:o.value,"onUpdate:visible":f[1]||(f[1]=M=>o.value=M),"channel-id":s.value,"initial-group-id":a.value,onSuccess:Oe,onClose:f[2]||(f[2]=M=>s.value=null)},null,8,["visible","channel-id","initial-group-id"]),t(go,{visible:d.value,"onUpdate:visible":f[3]||(f[3]=M=>d.value=M),"group-id":i.value,"parent-options":p.value,onSuccess:Fe,onClose:f[4]||(f[4]=M=>i.value=null)},null,8,["visible","group-id","parent-options"])],64)}}}),ho=H(bo,[["__scopeId","data-v-3854c9ca"]]),Vo={__name:"AppHeader",setup(e){const n=He(),o=V([]),d=i=>{T.value=i,localStorage.setItem("isCollapse",T.value.toString())};return A(()=>n.path,()=>{o.value=n.matched.filter(i=>i.meta?.title)},{immediate:!0}),(i,a)=>{const v=se,c=gt,r=_t,h=yt;return y(),I(h,{class:"app-header"},{default:l(()=>[t(v,{onClick:a[0]||(a[0]=w=>d(!m(T)))},{default:l(()=>[ce(t(m(vt),null,null,512),[[pe,m(T)]]),ce(t(m(ft),null,null,512),[[pe,!m(T)]])]),_:1}),t(r,{separator:"/"},{default:l(()=>[(y(!0),$(K,null,Y(o.value,(w,D)=>(y(),I(c,{key:D,to:w.path},{default:l(()=>[E(W(w.meta.title),1)]),_:2},1032,["to"]))),128))]),_:1}),a[1]||(a[1]=G("div",{class:"breadcrumb-divider"},null,-1))]),_:1})}}},wo=H(Vo,[["__scopeId","data-v-ed7c83fb"]]),ko={__name:"App",setup(e){return(n,o)=>{const d=ze("router-view"),s=Ne,i=ht,a=bt;return y(),$("div",{class:ee(`theme-wrapper theme-${m(j)}`)},[t(a,{class:"app-container"},{default:l(()=>[t(ho),t(a,{direction:"vertical"},{default:l(()=>[t(wo),t(i,{class:"main-content"},{default:l(()=>[t(s,null,{default:l(()=>[t(d)]),_:1})]),_:1})]),_:1})]),_:1})],2)}}},Co={install:e=>{e.directive("decimal",{mounted(n,o){const d=n.querySelector("input")||n,s=o.value||2,i=()=>{let v=d.value;v=v.replace(/[^\d.-]/g,"").replace(/(\..*)\./g,"$1").replace(/(\-.*)\-/g,"$1"),d.value=v},a=()=>{let v=d.value;if(v.includes(".")){const c=v.split(".");d.value=`${c[0]}.${c[1].slice(0,s)}`}};d.addEventListener("input",i),d.addEventListener("blur",a)}})}},de=je(ko);for(const[e,n]of Object.entries(Vt))de.component(e,n);de.use(Co);de.use(re);de.mount("#app");
