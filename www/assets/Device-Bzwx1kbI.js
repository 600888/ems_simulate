import{E as Ce,W as We,X as ml,Y as cl,c as pl,Z as vl,v as fl,_ as _l,r as ge,H as ue,t as de,u as re,C as fe,b as Z,K as w,D as Fe,z as we,A as De,$ as je,x as Je,y as Qe,B as Le,J as Se,a0 as Ze,a1 as el,a2 as ll,a3 as al,a4 as tl,a5 as ol,d as bl,a6 as gl,a7 as nl,k as Vl,a8 as sl,n as Pe,a9 as xl,aa as yl,p as Ke,ab as Cl,ac as wl,l as Re,ad as Me,N as Dl,ae as Sl}from"./element-plus-Drht8FjI.js";import{o as J,y as F,v as _,A as V,M as e,H as P,E as l,t as U,I as Al,K as L,G as ye,r as C,U as Q,S as _e,au as qe,a0 as Ae,F as ze,J as I,a3 as ie,L as se,av as Ve,c as z,b6 as Ye,u as Y,W as He,aO as Bl,aG as hl}from"./vendor-D7VVe7DO.js";import{_ as ae,e as Be,a as kl,b as Ul,c as ul,s as Il,d as Nl,f as $l,h as El,j as Rl,k as Ml,l as Oe,m as Tl,n as Xe,o as Te,p as Fl,q as Ll,t as Pl,u as ql,v as zl,w as Yl,x as Hl,y as Wl,z as Kl,A as Ol,B as Ge,C as Xl,D as Gl}from"./Device.vue_vue_type_style_index_0_scoped_83bfaf52_lang-C1neuMVR.js";var ve=(x=>(x[x.YC=0]="YC",x[x.YX=1]="YX",x[x.YK=2]="YK",x[x.YT=3]="YT",x))(ve||{});const jl={遥测:0,遥信:1,遥控:2,遥调:3};function Ee(x,E=0){return jl[x]??E}const Jl={class:"card-inner"},Ql={class:"icon-section"},Zl={key:0,class:"status-indicator"},ea={class:"content-section"},la={class:"label-row"},aa={class:"card-label"},ta={class:"value-row"},oa={class:"card-value"},na=J({__name:"TextNode",props:{label:{type:String,required:!0},name:{type:String,required:!0},status:{type:Boolean,default:null}},setup(x){const E=o=>{const m=o.toLowerCase();return m.includes("地址")?We:m.includes("端口")?We:m.includes("串口")?ml:m.includes("波特率")?cl:m.includes("通讯")?pl:m.includes("设备状态")?vl:m.includes("模拟状态")?fl:_l};return(o,m)=>{const s=Ce;return _(),F("div",{class:ye(["data-card",[`status-${x.status===null?"info":x.status?"success":"danger"}`,{"has-status":x.status!==null}]])},[V("div",Jl,[V("div",Ql,[e(s,{class:"feature-icon"},{default:l(()=>[(_(),U(Al(E(x.label))))]),_:1}),x.status===!0?(_(),F("span",Zl)):P("",!0)]),V("div",ea,[V("div",la,[V("span",aa,L(x.label),1)]),V("div",ta,[V("span",oa,L(x.name),1)])])])],2)}}}),pe=ae(na,[["__scopeId","data-v-86e9483e"]]),sa={class:"register"},ua={class:"simple-title"},da=J({__name:"SingleRegister",props:{rowIndex:{type:Number,required:!0},deviceName:{type:String,required:!0},pointCode:{type:String,required:!0},realValue:{type:Number,required:!0},mulCoe:{type:Number,default:1},addCoe:{type:Number,default:0}},emits:["editSuccess"],setup(x,{emit:E}){const o=d=>{if(d<-32768||d>65535)throw new Error("Value exceeds 16-bit integer range");const t=new ArrayBuffer(2),n=new DataView(t),a=d<0?65536+d:d;return n.setUint16(0,a,!1),"0x"+n.getUint16(0,!1).toString(16).toUpperCase().padStart(4,"0")},m=x,s=C({signed:0,unsigned:0,hex:"",bin:"",real:0,mulCoe:1,addCoe:0}),u=()=>{s.value={signed:0,unsigned:0,hex:"0000",bin:"0000000000000000",real:0,mulCoe:1,addCoe:0}},v=E,g=async()=>{await Be(m.deviceName,m.pointCode,parseFloat(s.value.real.toString()))?(v("editSuccess",m.rowIndex,parseFloat(s.value.real.toString()),o(s.value.signed)),w({message:"修改成功!",type:"success"})):w({message:"修改失败!",type:"error"})};function b(d){const t=parseInt(((d-s.value.addCoe)/s.value.mulCoe).toString());if(t<-32768||t>65535)return;let n=t;t>32767&&(n=t-65535);let a=t;t<0&&(a=65536+t),a=Math.max(0,Math.min(65535,a)),n=Math.max(-32768,Math.min(32767,n)),s.value={signed:n,unsigned:a,hex:a.toString(16).toUpperCase().padStart(4,"0"),bin:a.toString(2).padStart(16,"0"),real:d,mulCoe:s.value.mulCoe,addCoe:s.value.addCoe}}return Q(()=>m.realValue,(d,t)=>{b(d)}),Q(()=>s.value.real,(d,t)=>{b(d)}),_e(()=>{s.value.mulCoe=m.mulCoe,s.value.addCoe=m.addCoe,b(m.realValue)}),(d,t)=>{const n=ge,a=re,i=de,A=ue,f=Z,D=fe,S=qe("decimal");return _(),F("div",sa,[V("div",ua,[t[6]||(t[6]=V("span",null,"寄存器解析",-1)),e(n)]),e(A,{"label-width":"auto",model:s.value,onSubmit:t[5]||(t[5]=Ae(()=>{},["prevent"]))},{default:l(()=>[e(i,{label:"Signed:","label-position":"right",class:"form-item"},{default:l(()=>[e(a,{modelValue:s.value.signed,"onUpdate:modelValue":t[0]||(t[0]=r=>s.value.signed=r),modelModifiers:{number:!0},disabled:""},null,8,["modelValue"])]),_:1}),e(i,{label:"Unsigned:","label-position":"right",class:"form-item"},{default:l(()=>[e(a,{modelValue:s.value.unsigned,"onUpdate:modelValue":t[1]||(t[1]=r=>s.value.unsigned=r),modelModifiers:{number:!0},disabled:""},null,8,["modelValue"])]),_:1}),e(i,{label:"Hex:","label-position":"right",class:"form-item"},{default:l(()=>[e(a,{modelValue:s.value.hex,"onUpdate:modelValue":t[2]||(t[2]=r=>s.value.hex=r),disabled:""},null,8,["modelValue"])]),_:1}),e(i,{label:"Binary:","label-position":"right",class:"form-item"},{default:l(()=>[e(a,{modelValue:s.value.bin,"onUpdate:modelValue":t[3]||(t[3]=r=>s.value.bin=r),disabled:""},null,8,["modelValue"])]),_:1}),e(i,{label:"Real:","label-position":"right",class:"form-item"},{default:l(()=>[ze(e(a,{modelValue:s.value.real,"onUpdate:modelValue":t[4]||(t[4]=r=>s.value.real=r)},null,8,["modelValue"]),[[S,2]])]),_:1})]),_:1},8,["model"]),e(D,{class:"custom-row"},{default:l(()=>[e(i,{class:"custom-form-item"},{default:l(()=>[e(f,{type:"primary",onClick:g},{default:l(()=>[...t[7]||(t[7]=[I("设置",-1)])]),_:1})]),_:1}),e(i,{class:"custom-form-item"},{default:l(()=>[e(f,{onClick:u},{default:l(()=>[...t[8]||(t[8]=[I("重置",-1)])]),_:1})]),_:1})]),_:1})])}}}),ra=ae(da,[["__scopeId","data-v-5535bf27"]]),ia={class:"register"},ma={class:"simple-title"},ca={class:"hex-value"},pa={class:"hex-value"},va={class:"hex-value"},fa={class:"hex-value"},_a=J({__name:"LongRegister",props:{rowIndex:{type:Number,required:!0},deviceName:{type:String,required:!0},pointCode:{type:String,required:!0},realValue:{type:Number,required:!0},mulCoe:{type:Number,default:1},addCoe:{type:Number,default:0}},emits:["editSuccess"],setup(x,{emit:E}){const o=d=>{const t=new ArrayBuffer(4),n=new DataView(t);return n.setUint32(0,d,!1),"0x"+n.getUint32(0,!1).toString(16).toUpperCase().padStart(8,"0")},m=x,s=C({longABCD:0,longCDAB:0,longBADC:0,longDCBA:0,real:0,mulCoe:1,addCoe:0}),u=()=>{s.value={longABCD:0,longCDAB:0,longBADC:0,longDCBA:0,real:0,mulCoe:1,addCoe:0}},v=E,g=async()=>{await Be(m.deviceName,m.pointCode,parseFloat(s.value.real.toString()))?(v("editSuccess",m.rowIndex,parseFloat(s.value.real.toString()),o(s.value.longABCD)),w({message:"修改成功!",type:"success"})):w({message:"修改失败!",type:"error"})};function b(d){const t=parseInt(((d-s.value.addCoe)/s.value.mulCoe).toString());if(t<-2147483648||t>4294967295)return;const n=t|0;s.value={longABCD:n,longCDAB:(n&4294901760)>>>16|(n&65535)<<16,longBADC:(n&4278255360)>>>8|(n&16711935)<<8,longDCBA:(n&4278190080)>>>24|(n&16711680)>>>8|(n&65280)<<8|(n&255)<<24,real:d,mulCoe:m.mulCoe,addCoe:m.addCoe}}return Q(()=>m.realValue,(d,t)=>{b(d)}),Q(()=>s.value.real,(d,t)=>{b(d)}),_e(()=>{s.value.mulCoe=m.mulCoe,s.value.addCoe=m.addCoe,b(m.realValue)}),(d,t)=>{const n=ge,a=re,i=de,A=ue,f=Z,D=fe,S=qe("decimal");return _(),F("div",ia,[V("div",ma,[t[6]||(t[6]=V("span",null,"寄存器解析",-1)),e(n)]),e(A,{"label-width":"auto",model:s.value,onSubmit:t[5]||(t[5]=Ae(()=>{},["prevent"]))},{default:l(()=>[e(i,{label:"Long AB CD:",class:"form-item"},{default:l(()=>[e(a,{modelValue:s.value.longABCD,"onUpdate:modelValue":t[0]||(t[0]=r=>s.value.longABCD=r),modelModifiers:{number:!0},disabled:""},{append:l(()=>[V("span",ca,L(o(s.value.longABCD)),1)]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"Long CD AB:",class:"form-item"},{default:l(()=>[e(a,{modelValue:s.value.longCDAB,"onUpdate:modelValue":t[1]||(t[1]=r=>s.value.longCDAB=r),modelModifiers:{number:!0},disabled:""},{append:l(()=>[V("span",pa,L(o(s.value.longCDAB)),1)]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"Long BA DC:",class:"form-item"},{default:l(()=>[e(a,{modelValue:s.value.longBADC,"onUpdate:modelValue":t[2]||(t[2]=r=>s.value.longBADC=r),disabled:""},{append:l(()=>[V("span",va,L(o(s.value.longBADC)),1)]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"Long DC BA:",class:"form-item"},{default:l(()=>[e(a,{modelValue:s.value.longDCBA,"onUpdate:modelValue":t[3]||(t[3]=r=>s.value.longDCBA=r),disabled:""},{append:l(()=>[V("span",fa,L(o(s.value.longDCBA)),1)]),_:1},8,["modelValue"])]),_:1}),e(i,{label:"Real:",class:"form-item"},{default:l(()=>[ze(e(a,{modelValue:s.value.real,"onUpdate:modelValue":t[4]||(t[4]=r=>s.value.real=r)},null,8,["modelValue"]),[[S,2]])]),_:1})]),_:1},8,["model"]),e(D,{class:"custom-row"},{default:l(()=>[e(i,{class:"custom-form-item"},{default:l(()=>[e(f,{type:"primary",onClick:g},{default:l(()=>[...t[7]||(t[7]=[I("设置",-1)])]),_:1})]),_:1}),e(i,{class:"custom-form-item"},{default:l(()=>[e(f,{onClick:u},{default:l(()=>[...t[8]||(t[8]=[I("重置",-1)])]),_:1})]),_:1})]),_:1})])}}}),ba=ae(_a,[["__scopeId","data-v-1cb94add"]]),ga={class:"register"},Va={class:"simple-title"},xa=J({__name:"FloatRegister",props:{rowIndex:{type:Number,required:!0},deviceName:{type:String,required:!0},pointCode:{type:String,required:!0},realValue:{type:Number,required:!0},mulCoe:{type:Number,default:1},addCoe:{type:Number,default:0}},emits:["editSuccess"],setup(x,{emit:E}){const o=x,m=C({floatABCD:0,floatCDAB:0,floatBADC:0,floatDCBA:0,real:0,mulCoe:1,addCoe:0}),s=()=>{m.value={floatABCD:0,floatCDAB:0,floatBADC:0,floatDCBA:0,real:0,mulCoe:1,addCoe:0}},u=E,v=async()=>{await Be(o.deviceName,o.pointCode,parseFloat(m.value.real.toString()))?(u("editSuccess",o.rowIndex,parseFloat(m.value.real.toString()),g(m.value.floatABCD)),w({message:"修改成功!",type:"success"})):w({message:"修改失败!",type:"error"})},g=t=>{const n=new ArrayBuffer(4),a=new DataView(n);return a.setFloat32(0,t,!1),"0x"+a.getUint32(0,!1).toString(16).toUpperCase().padStart(8,"0")};function b(t){const n=(t-m.value.addCoe)/m.value.mulCoe,a=new ArrayBuffer(4),i=new DataView(a);i.setFloat32(0,n,!1),i.getUint32(0,!1),m.value={floatABCD:i.getFloat32(0,!1),floatCDAB:new DataView(d(a,"CDAB")).getFloat32(0,!1),floatBADC:new DataView(d(a,"BADC")).getFloat32(0,!1),floatDCBA:new DataView(d(a,"DCBA")).getFloat32(0,!1),real:t,mulCoe:o.mulCoe,addCoe:o.addCoe}}function d(t,n){const i=new DataView(t).getUint32(0,!1),A=new ArrayBuffer(4),f=new DataView(A);switch(n){case"CDAB":f.setUint32(0,(i&4294901760)>>>16|(i&65535)<<16,!1);break;case"BADC":f.setUint32(0,(i&4278255360)>>>8|(i&16711935)<<8,!1);break;case"DCBA":f.setUint32(0,(i&4278190080)>>>24|(i&16711680)>>>8|(i&65280)<<8|(i&255)<<24,!1)}return A}return Q(()=>o.realValue,(t,n)=>{b(t)}),Q(()=>m.value.real,(t,n)=>{b(t)}),_e(()=>{m.value.mulCoe=o.mulCoe,m.value.addCoe=o.addCoe,b(o.realValue)}),(t,n)=>{const a=ge,i=re,A=de,f=ue,D=Z,S=fe,r=qe("decimal");return _(),F("div",ga,[V("div",Va,[n[6]||(n[6]=V("span",null,"寄存器解析",-1)),e(a)]),e(f,{"label-width":"auto",model:m.value,onSubmit:n[5]||(n[5]=Ae(()=>{},["prevent"]))},{default:l(()=>[e(A,{label:"Float AB CD:",class:"form-item"},{default:l(()=>[e(i,{modelValue:m.value.floatABCD,"onUpdate:modelValue":n[0]||(n[0]=y=>m.value.floatABCD=y),modelModifiers:{number:!0},disabled:""},{append:l(()=>[V("span",null,"("+L(g(m.value.floatABCD))+")",1)]),_:1},8,["modelValue"])]),_:1}),e(A,{label:"Float CD AB:",class:"form-item"},{default:l(()=>[e(i,{modelValue:m.value.floatCDAB,"onUpdate:modelValue":n[1]||(n[1]=y=>m.value.floatCDAB=y),modelModifiers:{number:!0},disabled:""},{append:l(()=>[V("span",null,"("+L(g(m.value.floatCDAB))+")",1)]),_:1},8,["modelValue"])]),_:1}),e(A,{label:"Float BA DC:",class:"form-item"},{default:l(()=>[e(i,{modelValue:m.value.floatBADC,"onUpdate:modelValue":n[2]||(n[2]=y=>m.value.floatBADC=y),disabled:""},{append:l(()=>[V("span",null,"("+L(g(m.value.floatBADC))+")",1)]),_:1},8,["modelValue"])]),_:1}),e(A,{label:"Float DC BA:",class:"form-item"},{default:l(()=>[e(i,{modelValue:m.value.floatDCBA,"onUpdate:modelValue":n[3]||(n[3]=y=>m.value.floatDCBA=y),disabled:""},{append:l(()=>[V("span",null,"("+L(g(m.value.floatDCBA))+")",1)]),_:1},8,["modelValue"])]),_:1}),e(A,{label:"Real:",class:"form-item"},{default:l(()=>[ze(e(i,{modelValue:m.value.real,"onUpdate:modelValue":n[4]||(n[4]=y=>m.value.real=y)},null,8,["modelValue"]),[[r,2]])]),_:1})]),_:1},8,["model"]),e(S,{class:"custom-row"},{default:l(()=>[e(A,{class:"custom-form-item"},{default:l(()=>[e(D,{type:"primary",onClick:v},{default:l(()=>[...n[7]||(n[7]=[I("设置",-1)])]),_:1})]),_:1}),e(A,{class:"custom-form-item"},{default:l(()=>[e(D,{onClick:s},{default:l(()=>[...n[8]||(n[8]=[I("重置",-1)])]),_:1})]),_:1})]),_:1})])}}}),ya=ae(xa,[["__scopeId","data-v-e1440fef"]]),Ca={class:"register"},wa={class:"simple-title"},Da=J({__name:"EditPointLimit",props:{deviceName:{type:String,required:!0},pointCode:{type:String,required:!0}},setup(x){const E=x,o=C({minValueLimit:0,maxValueLimit:0}),m=()=>{o.value={minValueLimit:0,maxValueLimit:0}},s=async()=>{if(o.value.minValueLimit>o.value.maxValueLimit){w({message:"最小值不能大于最大值!",type:"error"});return}await Ul(E.deviceName,E.pointCode,o.value.minValueLimit,o.value.maxValueLimit)?w({message:"修改成功!",type:"success"}):w({message:"修改失败!",type:"error"})};return _e(async()=>{const u=await kl(E.deviceName,E.pointCode);o.value.maxValueLimit=u.maxValueLimit,o.value.minValueLimit=u.minValueLimit}),(u,v)=>{const g=ge,b=re,d=de,t=ue,n=Z,a=fe;return _(),F("div",Ca,[V("div",wa,[v[3]||(v[3]=V("span",null,"上下限值设置",-1)),e(g)]),e(t,{"label-width":"auto",model:o.value,onSubmit:v[2]||(v[2]=Ae(()=>{},["prevent"]))},{default:l(()=>[e(d,{label:"测点上限值(真实值):","label-position":"right",class:"form-item"},{default:l(()=>[e(b,{modelValue:o.value.maxValueLimit,"onUpdate:modelValue":v[0]||(v[0]=i=>o.value.maxValueLimit=i),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1}),e(d,{label:"测点下限值(真实值):","label-position":"right",class:"form-item"},{default:l(()=>[e(b,{modelValue:o.value.minValueLimit,"onUpdate:modelValue":v[1]||(v[1]=i=>o.value.minValueLimit=i),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),e(a,{class:"custom-row"},{default:l(()=>[e(d,{class:"custom-form-item"},{default:l(()=>[e(n,{type:"primary",onClick:s},{default:l(()=>[...v[4]||(v[4]=[I("设置",-1)])]),_:1})]),_:1}),e(d,{class:"custom-form-item"},{default:l(()=>[e(n,{onClick:m},{default:l(()=>[...v[5]||(v[5]=[I("重置",-1)])]),_:1})]),_:1})]),_:1})])}}}),Sa=ae(Da,[["__scopeId","data-v-2c869f80"]]),Aa={class:"register"},Ba={class:"simple-title"},ha={key:0,class:"special-params"},ka=J({__name:"PointSimulator",props:{deviceName:{},pointCode:{}},emits:["update-success"],setup(x,{emit:E}){const o=x,m=E,s=C([{value:"Random",label:"随机模拟"},{value:"AutoIncrement",label:"自增模拟"},{value:"AutoDecrement",label:"自减模拟"},{value:"SineWave",label:"正弦波模拟"},{value:"Ramp",label:"斜坡模拟"},{value:"Pulse",label:"脉冲模拟"}]),u=ie({simulateMethod:"Random",step:1,minValue:0,maxValue:100,period:10,phase:0,rampTime:5,pulseWidth:2,pulseInterval:5}),v=C(!1);Q(()=>u.simulateMethod,n=>{v.value=["SineWave","Ramp","Pulse"].includes(n)});const g=async()=>{try{const n=await ul(o.deviceName,o.pointCode);n&&(u.step=n.step||1,u.minValue=n.min_value||0,u.maxValue=n.max_value||100,u.simulateMethod=n.simulate_method||"Random",n.period&&(u.period=n.period),n.phase&&(u.phase=n.phase),n.ramp_time&&(u.rampTime=n.ramp_time),n.pulse_width&&(u.pulseWidth=n.pulse_width),n.pulse_interval&&(u.pulseInterval=n.pulse_interval),w.success("加载点信息成功"))}catch(n){console.error("加载点信息失败:",n),w.error("加载点信息失败")}},b=async()=>{try{if(u.minValue>=u.maxValue){w.warning("最小值必须小于最大值");return}const n=await Il(o.deviceName,o.pointCode,u.simulateMethod),a=await Nl(o.deviceName,o.pointCode,u.step),i=await $l(o.deviceName,o.pointCode,u.minValue,u.maxValue);n&&a&&i?(w.success("设置保存成功"),m("update-success")):w.error("设置保存失败")}catch(n){console.error("保存设置失败:",n),w.error("保存设置失败")}},d=()=>{u.simulateMethod="Random",u.step=1,u.minValue=0,u.maxValue=100,u.period=10,u.phase=0,u.rampTime=5,u.pulseWidth=2,u.pulseInterval=5,w.success("设置已重置")},t=()=>{};return(n,a)=>{const i=ge,A=De,f=we,D=de,S=Fe,r=re,y=fe,N=Z,M=ue;return _(),F("div",Aa,[V("div",Ba,[a[9]||(a[9]=V("span",null,"单点模拟设置",-1)),e(i)]),e(M,{"label-width":"auto",model:u},{default:l(()=>[e(y,null,{default:l(()=>[e(S,{span:12},{default:l(()=>[e(D,{label:"模拟方法","label-position":"right",class:"form-item"},{default:l(()=>[e(f,{modelValue:u.simulateMethod,"onUpdate:modelValue":a[0]||(a[0]=p=>u.simulateMethod=p),placeholder:"请选择模拟方法",style:{width:"90%"},onChange:t},{default:l(()=>[(_(!0),F(se,null,Ve(s.value,p=>(_(),U(A,{key:p.value,label:p.label,value:p.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(S,{span:12},{default:l(()=>[e(D,{label:"步长","label-position":"right",class:"form-item"},{default:l(()=>[e(r,{modelValue:u.step,"onUpdate:modelValue":a[1]||(a[1]=p=>u.step=p),modelModifiers:{number:!0},type:"number",placeholder:"请输入步长",style:{width:"90%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(y,null,{default:l(()=>[e(S,{span:12},{default:l(()=>[e(D,{label:"最小值","label-position":"right",class:"form-item"},{default:l(()=>[e(r,{modelValue:u.minValue,"onUpdate:modelValue":a[2]||(a[2]=p=>u.minValue=p),modelModifiers:{number:!0},type:"number",placeholder:"请输入最小值",style:{width:"90%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(S,{span:12},{default:l(()=>[e(D,{label:"最大值","label-position":"right",class:"form-item"},{default:l(()=>[e(r,{modelValue:u.maxValue,"onUpdate:modelValue":a[3]||(a[3]=p=>u.maxValue=p),modelModifiers:{number:!0},type:"number",placeholder:"请输入最大值",style:{width:"90%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(y,null,{default:l(()=>[e(S,{span:24},{default:l(()=>[e(D,{label:"特殊参数","label-position":"right",class:"form-item"},{default:l(()=>[v.value?(_(),F("div",ha,[u.simulateMethod==="SineWave"?(_(),U(r,{key:0,modelValue:u.period,"onUpdate:modelValue":a[4]||(a[4]=p=>u.period=p),modelModifiers:{number:!0},type:"number",placeholder:"请输入周期(秒)",style:{width:"90%"}},null,8,["modelValue"])):P("",!0),u.simulateMethod==="SineWave"?(_(),U(r,{key:1,modelValue:u.phase,"onUpdate:modelValue":a[5]||(a[5]=p=>u.phase=p),modelModifiers:{number:!0},type:"number",placeholder:"请输入相位(度)",style:{width:"90%"}},null,8,["modelValue"])):P("",!0),u.simulateMethod==="Ramp"?(_(),U(r,{key:2,modelValue:u.rampTime,"onUpdate:modelValue":a[6]||(a[6]=p=>u.rampTime=p),modelModifiers:{number:!0},type:"number",placeholder:"请输入斜坡时间(秒)",style:{width:"90%"}},null,8,["modelValue"])):P("",!0),u.simulateMethod==="Pulse"?(_(),U(r,{key:3,modelValue:u.pulseWidth,"onUpdate:modelValue":a[7]||(a[7]=p=>u.pulseWidth=p),modelModifiers:{number:!0},type:"number",placeholder:"请输入脉冲宽度(秒)",style:{width:"200px"}},null,8,["modelValue"])):P("",!0),u.simulateMethod==="Pulse"?(_(),U(r,{key:4,modelValue:u.pulseInterval,"onUpdate:modelValue":a[8]||(a[8]=p=>u.pulseInterval=p),modelModifiers:{number:!0},type:"number",placeholder:"请输入脉冲间隔(秒)",style:{width:"200px"}},null,8,["modelValue"])):P("",!0)])):P("",!0)]),_:1})]),_:1})]),_:1}),e(y,{class:"custom-row"},{default:l(()=>[e(D,{class:"custom-form-item"},{default:l(()=>[e(N,{type:"primary",onClick:b},{default:l(()=>[...a[10]||(a[10]=[I("保存设置",-1)])]),_:1})]),_:1}),e(D,{class:"custom-form-item"},{default:l(()=>[e(N,{onClick:g},{default:l(()=>[...a[11]||(a[11]=[I("加载点信息",-1)])]),_:1})]),_:1}),e(D,{class:"custom-form-item"},{default:l(()=>[e(N,{onClick:d},{default:l(()=>[...a[12]||(a[12]=[I("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])])}}}),Ua={class:"edit-metadata"},Ia={class:"simple-title"},Na={class:"button-group"},$a=J({__name:"EditPointMetadata",props:{deviceName:{},pointCode:{}},emits:["update-success"],setup(x,{emit:E}){const o=x,m=E,s=ie({name:"",code:"",reg_addr:"",func_code:3,decode_code:"",mul_coe:1,add_coe:0,frame_type:0}),u=z(()=>[0,3].includes(s.frame_type)),v=async()=>{try{const b=await ul(o.deviceName,o.pointCode);b&&(s.name=b.name||"",s.code=b.code||"",s.reg_addr=b.reg_addr||"",s.func_code=b.func_code||3,s.decode_code=b.decode_code||"",s.mul_coe=b.mul_coe??1,s.add_coe=b.add_coe??0,s.frame_type=b.frame_type??0)}catch(b){console.error("加载点信息失败:",b)}},g=async()=>{try{await El(o.deviceName,o.pointCode,s)?(w.success("测点属性已更新"),m("update-success",s.code)):w.error("更新失败")}catch(b){w.error("更新失败: "+b.message)}};return _e(()=>{v()}),(b,d)=>{const t=ge,n=re,a=de,i=Fe,A=fe,f=De,D=je,S=we,r=Z,y=ue;return _(),F("div",Ua,[V("div",Ia,[d[7]||(d[7]=V("span",null,"编辑测点属性",-1)),e(t)]),e(y,{"label-width":"auto",model:s},{default:l(()=>[e(A,{gutter:20},{default:l(()=>[e(i,{span:12},{default:l(()=>[e(a,{label:"名称",class:"form-item"},{default:l(()=>[e(n,{modelValue:s.name,"onUpdate:modelValue":d[0]||(d[0]=N=>s.name=N)},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:12},{default:l(()=>[e(a,{label:"编码",class:"form-item"},{default:l(()=>[e(n,{modelValue:s.code,"onUpdate:modelValue":d[1]||(d[1]=N=>s.code=N)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(A,{gutter:20},{default:l(()=>[e(i,{span:12},{default:l(()=>[e(a,{label:"地址",class:"form-item"},{default:l(()=>[e(n,{modelValue:s.reg_addr,"onUpdate:modelValue":d[2]||(d[2]=N=>s.reg_addr=N)},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:12},{default:l(()=>[e(a,{label:"解析码",class:"form-item"},{default:l(()=>[e(S,{modelValue:s.decode_code,"onUpdate:modelValue":d[3]||(d[3]=N=>s.decode_code=N),placeholder:"选择解析码"},{default:l(()=>[e(D,{label:"16位整数"},{default:l(()=>[e(f,{label:"0x20 - 无符号(大端)",value:"0x20"}),e(f,{label:"0x21 - 有符号(大端)",value:"0x21"}),e(f,{label:"0xC0 - 无符号(小端)",value:"0xC0"}),e(f,{label:"0xC1 - 有符号(小端)",value:"0xC1"}),e(f,{label:"0xB0 - 无符号(大端字交换)",value:"0xB0"}),e(f,{label:"0xB1 - 有符号(大端字交换)",value:"0xB1"})]),_:1}),e(D,{label:"32位整数"},{default:l(()=>[e(f,{label:"0x40 - 无符号(大端)",value:"0x40"}),e(f,{label:"0x41 - 有符号(大端)",value:"0x41"}),e(f,{label:"0xD0 - 无符号(小端)",value:"0xD0"}),e(f,{label:"0xD1 - 有符号(小端)",value:"0xD1"}),e(f,{label:"0x43 - 无符号(大端字交换)",value:"0x43"}),e(f,{label:"0x44 - 有符号(大端字交换)",value:"0x44"}),e(f,{label:"0xD4 - 无符号(小端字交换)",value:"0xD4"}),e(f,{label:"0xD5 - 有符号(小端字交换)",value:"0xD5"})]),_:1}),e(D,{label:"32位浮点"},{default:l(()=>[e(f,{label:"0x42 - Float(大端)",value:"0x42"}),e(f,{label:"0xD2 - Float(小端)",value:"0xD2"}),e(f,{label:"0x45 - Float(大端字交换)",value:"0x45"}),e(f,{label:"0xD3 - Float(小端字交换)",value:"0xD3"})]),_:1}),e(D,{label:"64位"},{default:l(()=>[e(f,{label:"0x60 - 无符号(大端)",value:"0x60"}),e(f,{label:"0x61 - 有符号(大端)",value:"0x61"}),e(f,{label:"0x62 - Double(大端)",value:"0x62"}),e(f,{label:"0xE0 - 无符号(小端)",value:"0xE0"}),e(f,{label:"0xE1 - 有符号(小端)",value:"0xE1"}),e(f,{label:"0xE2 - Double(小端)",value:"0xE2"})]),_:1}),e(D,{label:"8位字符"},{default:l(()=>[e(f,{label:"0x10 - 无符号",value:"0x10"}),e(f,{label:"0x11 - 有符号",value:"0x11"})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(A,{gutter:20},{default:l(()=>[e(i,{span:12},{default:l(()=>[e(a,{label:"功能码",class:"form-item"},{default:l(()=>[e(n,{modelValue:s.func_code,"onUpdate:modelValue":d[4]||(d[4]=N=>s.func_code=N),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),u.value?(_(),U(A,{key:0,gutter:20},{default:l(()=>[e(i,{span:12},{default:l(()=>[e(a,{label:"乘系数",class:"form-item"},{default:l(()=>[e(n,{modelValue:s.mul_coe,"onUpdate:modelValue":d[5]||(d[5]=N=>s.mul_coe=N),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"])]),_:1})]),_:1}),e(i,{span:12},{default:l(()=>[e(a,{label:"加系数",class:"form-item"},{default:l(()=>[e(n,{modelValue:s.add_coe,"onUpdate:modelValue":d[6]||(d[6]=N=>s.add_coe=N),modelModifiers:{number:!0},type:"number"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):P("",!0),V("div",Na,[e(r,{type:"primary",onClick:g},{default:l(()=>[...d[8]||(d[8]=[I("保存属性",-1)])]),_:1}),e(r,{onClick:v},{default:l(()=>[...d[9]||(d[9]=[I("刷新",-1)])]),_:1})])]),_:1},8,["model"])])}}}),Ea=ae($a,[["__scopeId","data-v-2d830585"]]),Ra={class:"dialog-footer"},Ma=J({__name:"WritePointDialog",props:{modelValue:{type:Boolean,default:!1},deviceName:{type:String,required:!0},pointCode:{type:String,required:!0},currentValue:{type:[Number,String],default:""},pointType:{type:Number,required:!0}},emits:["update:modelValue","success"],setup(x,{emit:E}){const o=x,m=E,s=z({get:()=>o.modelValue,set:d=>m("update:modelValue",d)}),u=C(!1),v=ie({pointCode:"",currentValue:"",value:0}),g=z(()=>o.pointType===2?"遥控操作":"遥调设置");Q(()=>o.modelValue,d=>{d&&(v.pointCode=o.pointCode,v.currentValue=String(o.currentValue),v.value=o.pointType===2?1:Number(o.currentValue)||0)});const b=async()=>{u.value=!0;try{const d=Number(v.value);await Be(o.deviceName,o.pointCode,d)?(w.success("写入指令已发送"),s.value=!1,m("success")):w.error("写入失败")}catch{w.error("操作发生错误")}finally{u.value=!1}};return(d,t)=>{const n=re,a=de,i=Qe,A=Je,f=Le,D=ue,S=Z,r=Se;return _(),U(r,{modelValue:s.value,"onUpdate:modelValue":t[6]||(t[6]=y=>s.value=y),title:g.value,width:"400px","destroy-on-close":"","close-on-click-modal":!1},{footer:l(()=>[V("span",Ra,[e(S,{onClick:t[5]||(t[5]=y=>s.value=!1)},{default:l(()=>[...t[9]||(t[9]=[I("取消",-1)])]),_:1}),e(S,{type:"primary",loading:u.value,onClick:b},{default:l(()=>[...t[10]||(t[10]=[I(" 确认写入 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[e(D,{model:v,"label-width":"80px"},{default:l(()=>[e(a,{label:"测点编码"},{default:l(()=>[e(n,{modelValue:v.pointCode,"onUpdate:modelValue":t[0]||(t[0]=y=>v.pointCode=y),disabled:""},null,8,["modelValue"])]),_:1}),e(a,{label:"当前值"},{default:l(()=>[e(n,{modelValue:v.currentValue,"onUpdate:modelValue":t[1]||(t[1]=y=>v.currentValue=y),disabled:""},null,8,["modelValue"])]),_:1}),x.pointType===2?(_(),U(a,{key:0,label:"操作"},{default:l(()=>[e(A,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=y=>v.value=y)},{default:l(()=>[e(i,{label:1},{default:l(()=>[...t[7]||(t[7]=[I("合 / 开 (1)",-1)])]),_:1}),e(i,{label:0},{default:l(()=>[...t[8]||(t[8]=[I("分 / 关 (0)",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})):x.pointType===3?(_(),U(a,{key:1,label:"设定值"},{default:l(()=>[e(f,{modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=y=>v.value=y),controls:!1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})):(_(),U(a,{key:2,label:"设定值"},{default:l(()=>[e(n,{modelValue:v.value,"onUpdate:modelValue":t[4]||(t[4]=y=>v.value=y)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),Ta={class:"modern-table-container"},Fa={class:"expand-wrapper"},La={class:"control-grid"},Pa={class:"header-content address-header"},qa={class:"cell-text"},za={class:"header-content"},Ya={key:0},Ha={key:1},Wa={key:2},Ka={class:"action-buttons"},Oa={class:"pagination-wrapper"},Xa="解析码说明: 16位(0x20/21/C0/C1), 32位整(0x40/41/D0/D1), 32位浮(0x42/D2), 64位(0x60/61/E0/E1)",Ga="01:读线圈 02:读离散输入 03:读保持寄存器 04:读输入寄存器",ja=J({__name:"Table",props:{slaveId:{type:Number,required:!0},tableHeader:{type:Array,required:!0},tableData:{type:Array,required:!0},total:{type:Number,required:!0},pageSize:{type:Number,required:!0},pageIndex:{type:Number,required:!0},activeFilters:{type:Object,required:!0},protocolType:{type:[Number,String],default:1}},emits:["update:pageSize","update:pageIndex","update:activeFilters","refresh"],setup(x,{emit:E}){const o=x,m=E,s=Ye(),u=z(()=>s.name),v=C("数据解析和设置"),g=C([]),b=["0x10","0x11","0x20","0x21","0x22","0xB0","0xB1","0xC0","0xC1"],d=["0x40","0x41","0x43","0x44","0xD0","0xD1","0xD4","0xD5","0x60","0x61","0xE0","0xE1"],t=["0x42","0x45","0xD2","0xD3","0x62","0xE2"],n=z(()=>{const c=o.protocolType;return c===0||c===1||typeof c=="string"&&c.startsWith("Modbus")});z(()=>typeof o.protocolType=="string"&&o.protocolType.includes("Dlt645"));const a=z(()=>{const c=o.protocolType;return["ModbusTcpClient","Iec104Client","Dlt645Client"].includes(String(c))}),i=ie({}),A=ie({}),f=C(!1),D=z(()=>{const c=["16进制地址","地址"];return n.value||c.push("位","功能码","解析码"),c}),S=z(()=>o.tableHeader.filter(c=>!D.value.includes(c))),r=z(()=>S.value),y={测点编码:150,测点名称:200,寄存器值:120,真实值:120,乘法系数:100,加法系数:100,位:60,功能码:80,解析码:90,帧类型:80,类型标识:100,传送原因:100,公共地址:100,信息体地址:120,数据标识:120,数据长度:80,default:100},N=z(()=>r.value.map(c=>y[c]||y.default)),M=c=>c.测点编码,p=(c,$)=>{const q=c.测点编码,j=$.some(K=>K.测点编码===q);g.value=j?[...g.value,q]:g.value.filter(K=>K!==q)},X=[{text:"遥测",value:ve.YC},{text:"遥信",value:ve.YX},{text:"遥控",value:ve.YK},{text:"遥调",value:ve.YT}],G=c=>m("update:activeFilters",c),ee=z(()=>o.tableData.map(c=>{const $={};return c.forEach((q,j)=>{if(j<o.tableHeader.length){const K=o.tableHeader[j];$[K]=j===o.tableHeader.length-4?parseFloat(q).toFixed(3):q}}),$})),te=z(()=>ee.value.filter(c=>Object.entries(o.activeFilters).every(([$,q])=>!q.length||q.includes(Ee(c.帧类型))))),R=c=>{m("update:pageSize",c),m("update:pageIndex",1)},T=c=>m("update:pageIndex",c),W=c=>({遥测:"success",遥信:"warning",遥控:"danger",遥调:"info"})[c]||"info",B=(c,$,q)=>{c!==-1&&(o.tableData[c][7]=q,o.tableData[c][8]=$)},oe=(c,$)=>{const q=g.value.indexOf($);q!==-1&&(g.value[q]=c),m("refresh")},me=()=>null,be=async c=>{i[c]=!0;try{const $=await Rl(u.value,c);$!==null?(w.success(`读取成功: ${$}`),m("refresh")):w.warning("读取失败，请检查连接状态")}catch{w.error("读取失败")}finally{i[c]=!1}},ce=C(!1),O=ie({code:"",value:"",type:0}),he=c=>{O.code=c.测点编码,O.value=c.真实值,O.type=Ee(c.帧类型),ce.value=!0},ke=()=>{m("refresh")},Ue=async c=>{A[c]=!0;try{await Ml(u.value,c)?(w.success("删除成功"),m("refresh")):w.error("删除失败")}catch{w.error("删除失败")}finally{A[c]=!1}},h=c=>["乘法系数","加法系数"].includes(c)?!0:n.value?["解析码","功能码"].includes(c):!1;return(c,$)=>{const q=al,j=ll,K=el,Ie=tl,xe=Ce,Ne=bl,H=ol,ne=Z,dl=sl,rl=Ze,il=xl;return _(),F(se,null,[V("div",Ta,[e(rl,{data:te.value,class:"custom-table","cell-class-name":()=>"modern-cell","header-cell-class-name":()=>"modern-header-cell",onFilterChange:G,"row-key":M,onExpandChange:p,"expand-row-keys":g.value,border:"",stripe:"",style:{width:"100%"}},{default:l(()=>[e(K,{type:"expand"},{default:l(k=>[V("div",Fa,[e(j,{modelValue:v.value,"onUpdate:modelValue":$[0]||($[0]=le=>v.value=le),class:"inner-tabs"},{default:l(()=>[e(q,{label:"配置与控制",name:"数据解析和设置"},{default:l(()=>[V("div",La,[b.includes(k.row.解析码)?(_(),U(ra,{key:0,rowIndex:k.$index,deviceName:u.value,pointCode:k.row.测点编码,realValue:parseFloat(k.row.真实值||0),onEditSuccess:B},null,8,["rowIndex","deviceName","pointCode","realValue"])):P("",!0),d.includes(k.row.解析码)?(_(),U(ba,{key:1,rowIndex:k.$index,deviceName:u.value,pointCode:k.row.测点编码,realValue:parseFloat(k.row.真实值||0),onEditSuccess:B},null,8,["rowIndex","deviceName","pointCode","realValue"])):P("",!0),t.includes(k.row.解析码)?(_(),U(ya,{key:2,rowIndex:k.$index,deviceName:u.value,pointCode:k.row.测点编码,realValue:parseFloat(k.row.真实值||0),onEditSuccess:B},null,8,["rowIndex","deviceName","pointCode","realValue"])):P("",!0),e(Sa,{deviceName:u.value,pointCode:k.row.测点编码},null,8,["deviceName","pointCode"])])]),_:2},1024),e(q,{label:"仿真模拟",name:"数据模拟"},{default:l(()=>[e(ka,{deviceName:u.value,pointCode:k.row.测点编码,onUpdateSuccess:me},null,8,["deviceName","pointCode"])]),_:2},1024),e(q,{label:"属性编辑",name:"测点编辑"},{default:l(()=>[e(Ea,{deviceName:u.value,pointCode:k.row.测点编码,onUpdateSuccess:le=>oe(le,k.row.测点编码)},null,8,["deviceName","pointCode","onUpdateSuccess"])]),_:2},1024)]),_:2},1032,["modelValue"])])]),_:1}),e(K,{label:"地址","min-width":130,"show-overflow-tooltip":""},{header:l(()=>[V("div",Pa,[$[3]||($[3]=V("span",null,"地址",-1)),e(Ie,{modelValue:f.value,"onUpdate:modelValue":$[1]||($[1]=k=>f.value=k),size:"small","inline-prompt":"","active-text":"Hex","inactive-text":"Dec",class:"address-switch"},null,8,["modelValue"])])]),default:l(k=>[V("span",qa,L(f.value?k.row["16进制地址"]:k.row.地址),1)]),_:1}),(_(!0),F(se,null,Ve(r.value,(k,le)=>(_(),U(K,{key:le,prop:k.toLowerCase(),label:k,"min-width":N.value[le],"show-overflow-tooltip":"",filters:le===r.value.length-1?X:void 0,fixed:le===r.value.length-1?"right":void 0},{header:l(()=>[V("div",za,[V("span",null,L(k),1),h(k)?(_(),U(Ne,{key:0,effect:"dark",placement:"top"},{content:l(()=>[k==="解析码"?(_(),F("div",Ya,L(Xa))):k==="功能码"?(_(),F("div",Ha,L(Ga))):(_(),F("div",Wa,"算法: 真实值 = 寄存器值 × 系数 + 偏移量"))]),default:l(()=>[e(xe,{class:"help-icon"},{default:l(()=>[e(Y(gl))]),_:1})]),_:2},1024)):P("",!0)])]),default:l($e=>[le===r.value.length-1?(_(),U(H,{key:0,type:W($e.row[k]),effect:"light",class:"status-tag"},{default:l(()=>[I(L($e.row[k]),1)]),_:2},1032,["type"])):(_(),F("span",{key:1,class:ye(["cell-text",{"high-contrast":k==="测点编码"}])},L($e.row[k]),3))]),_:2},1032,["prop","label","min-width","filters","fixed"]))),128)),e(K,{label:"操作",width:a.value?240:100,fixed:"right"},{default:l(k=>[V("div",Ka,[a.value?(_(),U(ne,{key:0,type:"primary",size:"small",icon:Y(nl),onClick:le=>be(k.row.测点编码),loading:i[k.row.测点编码]},{default:l(()=>[...$[4]||($[4]=[I(" 读取 ",-1)])]),_:1},8,["icon","onClick","loading"])):P("",!0),a.value&&[Y(ve).YK,Y(ve).YT].includes(Y(Ee)(k.row.帧类型))?(_(),U(ne,{key:1,type:"success",size:"small",icon:Y(Vl),onClick:le=>he(k.row)},{default:l(()=>[...$[5]||($[5]=[I(" 写入 ",-1)])]),_:1},8,["icon","onClick"])):P("",!0),e(dl,{title:"确定要删除这个测点吗？","confirm-button-text":"删除","cancel-button-text":"取消",onConfirm:le=>Ue(k.row.测点编码)},{reference:l(()=>[e(ne,{type:"danger",size:"small",icon:Y(Pe),loading:A[k.row.测点编码]},{default:l(()=>[...$[6]||($[6]=[I(" 删除 ",-1)])]),_:1},8,["icon","loading"])]),_:2},1032,["onConfirm"])])]),_:1},8,["width"])]),_:1},8,["data","expand-row-keys"]),V("div",Oa,[e(il,{onSizeChange:R,onCurrentChange:T,"current-page":x.pageIndex,"page-sizes":[10,20,50,100],"page-size":x.pageSize,background:"",layout:"total, sizes, prev, pager, next, jumper",total:x.total},null,8,["current-page","page-size","total"])])]),e(Ma,{modelValue:ce.value,"onUpdate:modelValue":$[2]||($[2]=k=>ce.value=k),deviceName:u.value,pointCode:O.code,currentValue:O.value,pointType:O.type,onSuccess:ke},null,8,["modelValue","deviceName","pointCode","currentValue","pointType"])],64)}}}),Ja=ae(ja,[["__scopeId","data-v-83877634"]]),Qa=J({__name:"AddPointDialog",props:{modelValue:{type:Boolean},deviceName:{},slaveIdList:{},currentSlaveId:{}},emits:["update:modelValue","success"],setup(x,{emit:E}){const o=x,m=E,s=z({get:()=>o.modelValue,set:S=>m("update:modelValue",S)}),u=C(),v=C(!1),g=C(!1),b=C(10),d={0:{code:"YC_",name:"遥测"},1:{code:"YX_",name:"遥信"},2:{code:"YK_",name:"遥控"},3:{code:"YT_",name:"遥调"}},t=C("YC_"),n=C("遥测"),a=ie({frame_type:0,code:"",name:"",rtu_addr:1,reg_addr:"0",func_code:3,decode_code:"0x41",mul_coe:1,add_coe:0});Q(()=>a.frame_type,S=>{const r=d[S]||{code:"POINT_",name:"测点"};t.value=r.code,n.value=r.name});const i=S=>["0x60","0x61","0x62","0xE0","0xE1","0xE2"].includes(S)?4:["0x40","0x41","0x42","0x43","0x44","0x45","0xD0","0xD1","0xD2","0xD3","0xD4","0xD5"].includes(S)?2:1,A=z(()=>({frame_type:[{required:!0,message:"请选择测点类型",trigger:"change"}],code:g.value?[]:[{required:!0,message:"请输入测点编码",trigger:"blur"}],name:g.value?[]:[{required:!0,message:"请输入测点名称",trigger:"blur"}],rtu_addr:[{required:!0,message:"请选择从机地址",trigger:"change"}],reg_addr:[{required:!0,message:"请输入寄存器地址",trigger:"blur"}]}));Q(()=>o.modelValue,S=>{S&&o.currentSlaveId&&(a.rtu_addr=o.currentSlaveId)});const f=()=>{s.value=!1,u.value?.resetFields(),g.value=!1},D=async()=>{try{if(await u.value?.validate(),v.value=!0,g.value){const S=a.reg_addr.startsWith("0x")?parseInt(a.reg_addr,16):parseInt(a.reg_addr),r=i(a.decode_code);let y=0;for(let N=0;N<b.value;N++){const M={...a,code:`${t.value}${String(N+1).padStart(3,"0")}`,name:`${n.value}${N+1}`,reg_addr:String(S+N*r)};await Oe(o.deviceName,M)&&y++}y===b.value?w.success(`成功添加 ${y} 个测点`):w.warning(`成功添加 ${y}/${b.value} 个测点`),m("success"),f()}else await Oe(o.deviceName,a)?(w.success("添加测点成功"),m("success"),f()):w.error("添加测点失败")}catch(S){console.error("表单验证失败:",S)}finally{v.value=!1}};return(S,r)=>{const y=Qe,N=Je,M=de,p=De,X=we,G=Le,ee=re,te=je,R=ue,T=Z,W=Se;return _(),U(W,{modelValue:s.value,"onUpdate:modelValue":r[14]||(r[14]=B=>s.value=B),title:g.value?"批量添加测点":"添加测点",width:"560px","close-on-click-modal":!1,onClose:f},{footer:l(()=>[e(T,{onClick:f},{default:l(()=>[...r[17]||(r[17]=[I("取消",-1)])]),_:1}),e(T,{type:"primary",loading:v.value,onClick:D},{default:l(()=>[I(L(g.value?`批量添加 ${b.value} 个`:"确定"),1)]),_:1},8,["loading"])]),default:l(()=>[e(R,{ref_key:"formRef",ref:u,model:a,rules:A.value,"label-width":"100px","label-position":"right"},{default:l(()=>[e(M,{label:"添加模式"},{default:l(()=>[e(N,{modelValue:g.value,"onUpdate:modelValue":r[0]||(r[0]=B=>g.value=B)},{default:l(()=>[e(y,{value:!1},{default:l(()=>[...r[15]||(r[15]=[I("单个添加",-1)])]),_:1}),e(y,{value:!0},{default:l(()=>[...r[16]||(r[16]=[I("批量添加",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(M,{label:"测点类型",prop:"frame_type"},{default:l(()=>[e(X,{modelValue:a.frame_type,"onUpdate:modelValue":r[1]||(r[1]=B=>a.frame_type=B),placeholder:"选择测点类型",style:{width:"100%"}},{default:l(()=>[e(p,{label:"遥测 (YC)",value:0}),e(p,{label:"遥信 (YX)",value:1}),e(p,{label:"遥控 (YK)",value:2}),e(p,{label:"遥调 (YT)",value:3})]),_:1},8,["modelValue"])]),_:1}),g.value?(_(),F(se,{key:0},[e(M,{label:"添加数量",prop:"batchCount"},{default:l(()=>[e(G,{modelValue:b.value,"onUpdate:modelValue":r[2]||(r[2]=B=>b.value=B),min:1,max:100,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(M,{label:"起始地址",prop:"reg_addr"},{default:l(()=>[e(ee,{modelValue:a.reg_addr,"onUpdate:modelValue":r[3]||(r[3]=B=>a.reg_addr=B),placeholder:"如: 0 或 0x0000"},null,8,["modelValue"])]),_:1}),e(M,{label:"编码前缀"},{default:l(()=>[e(ee,{modelValue:t.value,"onUpdate:modelValue":r[4]||(r[4]=B=>t.value=B),placeholder:"如: POINT_"},null,8,["modelValue"])]),_:1}),e(M,{label:"名称前缀"},{default:l(()=>[e(ee,{modelValue:n.value,"onUpdate:modelValue":r[5]||(r[5]=B=>n.value=B),placeholder:"如: 测点"},null,8,["modelValue"])]),_:1})],64)):(_(),F(se,{key:1},[e(M,{label:"测点编码",prop:"code"},{default:l(()=>[e(ee,{modelValue:a.code,"onUpdate:modelValue":r[6]||(r[6]=B=>a.code=B),placeholder:"输入测点编码"},null,8,["modelValue"])]),_:1}),e(M,{label:"测点名称",prop:"name"},{default:l(()=>[e(ee,{modelValue:a.name,"onUpdate:modelValue":r[7]||(r[7]=B=>a.name=B),placeholder:"输入测点名称"},null,8,["modelValue"])]),_:1}),e(M,{label:"寄存器地址",prop:"reg_addr"},{default:l(()=>[e(ee,{modelValue:a.reg_addr,"onUpdate:modelValue":r[8]||(r[8]=B=>a.reg_addr=B),placeholder:"如: 0x0000 或 0"},null,8,["modelValue"])]),_:1})],64)),e(M,{label:"从机地址",prop:"rtu_addr"},{default:l(()=>[e(X,{modelValue:a.rtu_addr,"onUpdate:modelValue":r[9]||(r[9]=B=>a.rtu_addr=B),placeholder:"选择从机地址",style:{width:"100%"}},{default:l(()=>[(_(!0),F(se,null,Ve(x.slaveIdList,B=>(_(),U(p,{key:B,label:`从机 ${B}`,value:B},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(M,{label:"功能码",prop:"func_code"},{default:l(()=>[e(X,{modelValue:a.func_code,"onUpdate:modelValue":r[10]||(r[10]=B=>a.func_code=B),placeholder:"选择功能码",style:{width:"100%"}},{default:l(()=>[e(p,{label:"01 - 读线圈",value:1}),e(p,{label:"02 - 读离散输入",value:2}),e(p,{label:"03 - 读保持寄存器",value:3}),e(p,{label:"04 - 读输入寄存器",value:4}),e(p,{label:"05 - 写单个线圈",value:5}),e(p,{label:"06 - 写单个寄存器",value:6})]),_:1},8,["modelValue"])]),_:1}),e(M,{label:"解析码",prop:"decode_code"},{default:l(()=>[e(X,{modelValue:a.decode_code,"onUpdate:modelValue":r[11]||(r[11]=B=>a.decode_code=B),placeholder:"选择解析码",style:{width:"100%"}},{default:l(()=>[e(te,{label:"8位字符"},{default:l(()=>[e(p,{label:"0x10 - Byte 无符号",value:"0x10"}),e(p,{label:"0x11 - Byte 有符号",value:"0x11"})]),_:1}),e(te,{label:"16位整数"},{default:l(()=>[e(p,{label:"0x20 - Short AB (大端)",value:"0x20"}),e(p,{label:"0x21 - Short AB 有符号",value:"0x21"}),e(p,{label:"0x22 - Short BA (字节交换)",value:"0x22"}),e(p,{label:"0xB0 - Short BA 无符号",value:"0xB0"}),e(p,{label:"0xB1 - Short BA 有符号",value:"0xB1"}),e(p,{label:"0xC0 - Short CD (小端)",value:"0xC0"}),e(p,{label:"0xC1 - Short CD 有符号",value:"0xC1"})]),_:1}),e(te,{label:"32位整数"},{default:l(()=>[e(p,{label:"0x40 - Long AB CD (大端)",value:"0x40"}),e(p,{label:"0x41 - Long AB CD 有符号",value:"0x41"}),e(p,{label:"0x43 - Long CD AB (字交换)",value:"0x43"}),e(p,{label:"0x44 - Long CD AB 有符号",value:"0x44"}),e(p,{label:"0xD0 - Long DC BA (小端)",value:"0xD0"}),e(p,{label:"0xD1 - Long DC BA 有符号",value:"0xD1"}),e(p,{label:"0xD4 - Long BA DC (小端字交换)",value:"0xD4"}),e(p,{label:"0xD5 - Long BA DC 有符号",value:"0xD5"})]),_:1}),e(te,{label:"32位浮点"},{default:l(()=>[e(p,{label:"0x42 - Float AB CD (大端)",value:"0x42"}),e(p,{label:"0x45 - Float CD AB (字交换)",value:"0x45"}),e(p,{label:"0xD2 - Float DC BA (小端)",value:"0xD2"}),e(p,{label:"0xD3 - Float BA DC (小端字交换)",value:"0xD3"})]),_:1}),e(te,{label:"64位类型"},{default:l(()=>[e(p,{label:"0x60 - Int64 AB CD EF GH (大端)",value:"0x60"}),e(p,{label:"0x61 - Int64 有符号",value:"0x61"}),e(p,{label:"0x62 - Double AB CD EF GH",value:"0x62"}),e(p,{label:"0xE0 - Int64 HG FE DC BA (小端)",value:"0xE0"}),e(p,{label:"0xE1 - Int64 小端有符号",value:"0xE1"}),e(p,{label:"0xE2 - Double 小端",value:"0xE2"})]),_:1})]),_:1},8,["modelValue"])]),_:1}),[0,3].includes(a.frame_type)?(_(),F(se,{key:2},[e(M,{label:"乘法系数",prop:"mul_coe"},{default:l(()=>[e(G,{modelValue:a.mul_coe,"onUpdate:modelValue":r[12]||(r[12]=B=>a.mul_coe=B),precision:6,step:.1,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(M,{label:"加法系数",prop:"add_coe"},{default:l(()=>[e(G,{modelValue:a.add_coe,"onUpdate:modelValue":r[13]||(r[13]=B=>a.add_coe=B),precision:6,step:1,style:{width:"100%"}},null,8,["modelValue"])]),_:1})],64)):P("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Za=ae(Qa,[["__scopeId","data-v-b681296c"]]),et=J({__name:"AddSlaveDialog",props:{modelValue:{type:Boolean},deviceName:{},existingSlaves:{}},emits:["update:modelValue","success"],setup(x,{emit:E}){const o=x,m=E,s=z({get:()=>o.modelValue,set:a=>m("update:modelValue",a)}),u=C(),v=C(!1),g=ie({slave_id:1}),d={slave_id:[{required:!0,message:"请输入从机地址",trigger:"blur"},{type:"number",min:1,max:255,message:"从机地址范围: 1-255",trigger:"blur"},{validator:(a,i,A)=>{o.existingSlaves.includes(i)?A(new Error(`从机 ${i} 已存在`)):A()},trigger:"blur"}]},t=()=>{s.value=!1,u.value?.resetFields()},n=async()=>{try{await u.value?.validate(),v.value=!0,await Tl(o.deviceName,g.slave_id)?(w.success("添加从机成功"),m("success"),t()):w.error("添加从机失败，请检查从机地址是否有效")}catch(a){console.error("表单验证失败:",a)}finally{v.value=!1}};return(a,i)=>{const A=Le,f=de,D=yl,S=ue,r=Z,y=Se;return _(),U(y,{modelValue:s.value,"onUpdate:modelValue":i[1]||(i[1]=N=>s.value=N),title:"添加从机",width:"400px","close-on-click-modal":!1,onClose:t},{footer:l(()=>[e(r,{onClick:t},{default:l(()=>[...i[2]||(i[2]=[I("取消",-1)])]),_:1}),e(r,{type:"primary",loading:v.value,onClick:n},{default:l(()=>[...i[3]||(i[3]=[I("确定",-1)])]),_:1},8,["loading"])]),default:l(()=>[e(S,{ref_key:"formRef",ref:u,model:g,rules:d,"label-width":"100px","label-position":"right"},{default:l(()=>[e(f,{label:"从机地址",prop:"slave_id"},{default:l(()=>[e(A,{modelValue:g.slave_id,"onUpdate:modelValue":i[0]||(i[0]=N=>g.slave_id=N),min:1,max:255,placeholder:"输入从机地址 (1-255)",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),x.existingSlaves.length>0?(_(),U(D,{key:0,title:`已存在的从机: ${x.existingSlaves.join(", ")}`,type:"info",closable:!1,style:{"margin-bottom":"10px"}},null,8,["title"])):P("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])}}}),lt=ae(et,[["__scopeId","data-v-2a8d6240"]]),at={class:"slave-container"},tt={class:"search-bar"},ot={class:"search-left"},nt={key:0,class:"auto-read-control"},st={class:"add-slave-tab"},ut=J({__name:"Slave",setup(x){const E=Ye(),o=C(E.name),m=C(""),s=C([]),u=C(1),v=C({}),g=C({}),b=C(10),d=C(1),t=C(0),n=C({}),a=C(1),i=C(2),A=C(!1),f=z(()=>{const h=String(a.value);return h==="Iec104Client"||h==="Iec104Server"?!1:i.value===0||i.value===1}),D=C(!1),S=C(!1),r=z(()=>Object.values(n.value).flat()),y=h=>{d.value=h},N=h=>{b.value=h},M=h=>{n.value=h,G(o.value,u.value,g.value[u.value]||"",d.value,b.value)},p=()=>T(u.value),X=async()=>{try{const h=await Te(o.value);h&&(a.value=h.get("type")??1,i.value=Number(h.get("conn_type")??2))}catch{console.warn("设备信息获取失败")}s.value=await Fl(o.value),s.value.length>0&&(u.value=s.value[0],m.value=s.value[0].toString(),await ee())},G=async(h,c,$,q,j)=>{const K=await Ll(h,c,$,q,j,r.value);K&&(v.value[c]||(v.value[c]={tableHeader:[],tableData:[],total:0}),v.value[c]={tableHeader:K.get("head_data"),tableData:K.get("table_data"),total:K.get("total")},c===u.value&&(t.value=K.get("total")))},ee=async()=>{for(const h of s.value)await G(o.value,h,"",d.value,b.value)},te=(h,c)=>h==="add"?(S.value=!0,!1):!0,R=h=>{h.paneName!=="add"&&h.index!==void 0&&(u.value=s.value[parseInt(h.index)],G(o.value,u.value,"",d.value,b.value))},T=h=>{G(o.value,h,g.value[h]||"",d.value,b.value)},W=async()=>{await ql(o.value)?(w.success("重置成功"),T(u.value)):w.error("重置失败")},B=async()=>{const h=await zl(o.value,u.value);h>=0?(w.success(`清空成功，共删除 ${h} 个测点`),T(u.value)):w.error("清空测点失败")};Q(()=>E.name,async h=>{h&&(be(),o.value=h,d.value=1,b.value=10,A.value=!1,await Xe(o.value),await X(),me())});const oe=C(null),me=()=>{oe.value||(oe.value=setInterval(()=>{G(o.value,u.value,g.value[u.value]||"",d.value,b.value)},1e3))},be=()=>{oe.value&&(clearInterval(oe.value),oe.value=null)},ce=async h=>{h?(await Yl(o.value),w.success("已启用自动读取")):(await Xe(o.value),w.success("已停止自动读取"))},O=async()=>{await Hl(o.value)?(await G(o.value,u.value,g.value[u.value]||"",d.value,b.value),w.success("手动读取成功")):w.error("手动读取失败")},he=async()=>{const h=await Pl(o.value);A.value=h,h&&me()};_e(async()=>{await X(),await he(),me()});const ke=()=>{G(o.value,u.value,g.value[u.value]||"",d.value,b.value)},Ue=async()=>{await X()};return He(()=>{be()}),(h,c)=>{const $=Ce,q=re,j=Z,K=sl,Ie=tl,xe=al,Ne=ll;return _(),F("div",at,[e(Ne,{modelValue:m.value,"onUpdate:modelValue":c[2]||(c[2]=H=>m.value=H),class:"modern-tabs",onTabClick:R,"before-leave":te},{default:l(()=>[(_(!0),F(se,null,Ve(s.value,H=>(_(),U(xe,{key:H,label:`从机 ${H}`,name:H.toString()},{default:l(()=>[V("div",tt,[V("div",ot,[e(q,{modelValue:g.value[H],"onUpdate:modelValue":ne=>g.value[H]=ne,placeholder:"搜索测点名称...",class:"modern-input",clearable:"",onKeyup:Bl(ne=>T(H),["enter"])},{prefix:l(()=>[e($,null,{default:l(()=>[e(Y(Cl))]),_:1})]),_:1},8,["modelValue","onUpdate:modelValue","onKeyup"]),e(j,{type:"primary",class:"modern-btn search-btn",onClick:ne=>T(H)},{default:l(()=>[...c[5]||(c[5]=[I(" 搜索 ",-1)])]),_:1},8,["onClick"]),e(j,{class:"modern-btn reset-btn",onClick:W,icon:Y(wl)},{default:l(()=>[...c[6]||(c[6]=[I(" 重置测点值 ",-1)])]),_:1},8,["icon"]),e(j,{class:"modern-btn add-btn",onClick:c[0]||(c[0]=ne=>D.value=!0),icon:Y(Ke)},{default:l(()=>[...c[7]||(c[7]=[I(" 添加测点 ",-1)])]),_:1},8,["icon"]),e(K,{title:"确定清空当前从机的所有测点吗？此操作不可恢复！","confirm-button-text":"确定","cancel-button-text":"取消",onConfirm:B},{reference:l(()=>[e(j,{class:"modern-btn clear-btn",type:"danger",icon:Y(Pe)},{default:l(()=>[...c[8]||(c[8]=[I(" 清空测点 ",-1)])]),_:1},8,["icon"])]),_:1}),f.value?(_(),F("div",nt,[c[10]||(c[10]=V("span",{class:"auto-read-label"},"自动读取",-1)),e(Ie,{modelValue:A.value,"onUpdate:modelValue":c[1]||(c[1]=ne=>A.value=ne),onChange:ce,"active-color":"#3b82f6","inactive-color":"#94a3b8"},null,8,["modelValue"]),A.value?P("",!0):(_(),U(j,{key:0,class:"modern-btn manual-read-btn",onClick:O,icon:Y(nl)},{default:l(()=>[...c[9]||(c[9]=[I(" 手动读取 ",-1)])]),_:1},8,["icon"]))])):P("",!0)])]),H===u.value?(_(),U(Ja,{key:0,slaveId:H,tableHeader:v.value[H]?.tableHeader||[],tableData:v.value[H]?.tableData||[],pageSize:b.value,pageIndex:d.value,total:v.value[H]?.total||0,activeFilters:n.value,protocolType:a.value,"onUpdate:pageSize":N,"onUpdate:pageIndex":y,"onUpdate:activeFilters":M,onRefresh:p},null,8,["slaveId","tableHeader","tableData","pageSize","pageIndex","total","activeFilters","protocolType"])):P("",!0)]),_:2},1032,["label","name"]))),128)),e(xe,{name:"add",closable:!1},{label:l(()=>[V("span",st,[e($,null,{default:l(()=>[e(Y(Ke))]),_:1}),c[11]||(c[11]=I(" 添加从机 ",-1))])]),_:1})]),_:1},8,["modelValue"]),e(Za,{modelValue:D.value,"onUpdate:modelValue":c[3]||(c[3]=H=>D.value=H),deviceName:o.value,slaveIdList:s.value,currentSlaveId:u.value,onSuccess:ke},null,8,["modelValue","deviceName","slaveIdList","currentSlaveId"]),e(lt,{modelValue:S.value,"onUpdate:modelValue":c[4]||(c[4]=H=>S.value=H),deviceName:o.value,existingSlaves:s.value,onSuccess:Ue},null,8,["modelValue","deviceName","existingSlaves"])])}}}),dt=ae(ut,[["__scopeId","data-v-f8bb3b4b"]]),rt={class:"toolbar"},it={class:"left-actions"},mt={class:"right-info"},ct={class:"msg-count"},pt={class:"length-badge"},vt=["title"],ft=J({__name:"MessageViewDialog",props:{modelValue:{type:Boolean},deviceName:{}},emits:["update:modelValue"],setup(x,{emit:E}){const o=x,m=E,s=z({get:()=>o.modelValue,set:f=>m("update:modelValue",f)}),u=C([]),v=C(!0);let g=null;const b=async()=>{if(o.deviceName)try{u.value=await Wl(o.deviceName,200)}catch(f){console.error("Failed to fetch messages:",f)}},d=()=>{g||(g=setInterval(b,1e3))},t=()=>{g&&(clearInterval(g),g=null)},n=()=>{v.value=!v.value,v.value?d():t()},a=async()=>{try{await Dl.confirm("确定要清空所有报文记录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await Kl(o.deviceName)?(u.value=[],w.success("报文已清空")):w.error("清空失败")}catch{}},i=()=>{t(),s.value=!1},A=({row:f})=>f.direction==="TX"?"tx-row":"rx-row";return Q(()=>o.modelValue,f=>{f?(b(),v.value&&d()):t()}),He(()=>{t()}),(f,D)=>{const S=Z,r=ol,y=el,N=Ze,M=Se;return _(),U(M,{modelValue:s.value,"onUpdate:modelValue":D[0]||(D[0]=p=>s.value=p),title:"实时报文查看",width:"900px","before-close":i,"destroy-on-close":"",class:"message-dialog"},{footer:l(()=>[e(S,{onClick:i},{default:l(()=>[...D[4]||(D[4]=[I("关闭",-1)])]),_:1})]),default:l(()=>[V("div",rt,[V("div",it,[e(S,{type:v.value?"warning":"success",onClick:n,icon:v.value?Y(Re):Y(Me)},{default:l(()=>[I(L(v.value?"暂停刷新":"开始刷新"),1)]),_:1},8,["type","icon"]),e(S,{type:"danger",onClick:a,icon:Y(Pe)},{default:l(()=>[...D[1]||(D[1]=[I(" 清空报文 ",-1)])]),_:1},8,["icon"])]),V("div",mt,[V("span",ct,"共 "+L(u.value.length)+" 条报文",1),v.value?(_(),U(r,{key:0,type:"success",size:"small"},{default:l(()=>[...D[2]||(D[2]=[I("自动刷新中",-1)])]),_:1})):(_(),U(r,{key:1,type:"info",size:"small"},{default:l(()=>[...D[3]||(D[3]=[I("已暂停",-1)])]),_:1}))])]),e(N,{data:u.value,stripe:"",height:"400",class:"message-table","row-class-name":A},{default:l(()=>[e(y,{prop:"formatted_time",label:"时间",width:"120","header-align":"center"}),e(y,{prop:"direction",label:"方向",width:"80",align:"center","header-align":"center"},{default:l(({row:p})=>[e(r,{type:p.direction==="TX"?"primary":"success",size:"small"},{default:l(()=>[I(L(p.direction==="TX"?"发送":"接收"),1)]),_:2},1032,["type"])]),_:1}),e(y,{prop:"length",label:"长度",width:"70",align:"center","header-align":"center"},{default:l(({row:p})=>[V("span",pt,L(p.length),1)]),_:1}),e(y,{prop:"hex_data",label:"数据 (HEX)","min-width":"400",align:"center","header-align":"center"},{default:l(({row:p})=>[V("span",{class:"hex-data",title:p.hex_data},L(p.hex_data),9,vt)]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])}}}),_t=ae(ft,[["__scopeId","data-v-b0a60a5f"]]),bt=5e3,gt=J({__name:"Device",setup(x){const E=Ye(),o=C(E.name),m=C(new Map),s=C(""),u=C(""),v=C(null),g=C(9600),b=C(""),d=C(!1),t=C(""),n=C(!1),a=C(""),i=C(!1),A=C(!1),f=z(()=>{const R=b.value;return R&&(R.includes("Dlt645")||R==="ModbusRtu")&&v.value}),D=[{value:"Random",label:"随机模拟"},{value:"AutoIncrement",label:"自增模拟"},{value:"AutoDecrement",label:"自减模拟"},{value:"SineWave",label:"正弦波模拟"},{value:"Ramp",label:"斜坡模拟"},{value:"Pulse",label:"脉冲模拟"}],S=C(D[0].value),r=z(()=>d.value?"停止设备":"开启设备"),y=z(()=>n.value?"停止":"开始"),N=async()=>{i.value=!0;try{d.value?await Ol(o.value)?(d.value=!1,t.value="停止",n.value&&(await Ge(o.value),n.value=!1,a.value="停止")):w.error("停止设备失败"):await Xl(o.value)?(d.value=!0,t.value="运行中"):w.error("启动设备失败")}catch(R){console.error(R),w.error(R.message||"操作失败")}finally{i.value=!1}},M=async()=>{try{const R=await Te(o.value);m.value=R,s.value=R.get("ip")||null,u.value=R.get("port")||null,v.value=R.get("serial_port")||null,g.value=R.get("baudrate")||9600,b.value=R.get("type")||null;const T=R.get("server_status");d.value=T,t.value=T===!0?"运行中":"停止";const W=R.get("simulation_status");n.value=W,a.value=W===!0?"运行中":"停止"}catch(R){console.error(R)}},p=async()=>{i.value=!0;try{n.value?await Ge(o.value)&&(n.value=!1,a.value="停止"):await Gl(o.value,S.value)&&(n.value=!0,a.value="运行中")}catch(R){console.error(R)}finally{i.value=!1}};let X=null;const G=async()=>{try{const R=await Te(o.value),T=R.get("server_status");d.value!==T&&(d.value=T,t.value=T===!0?"运行中":"停止",T===!0?w.success(`设备 ${o.value} 已连接`):w.warning(`设备 ${o.value} 连接已断开`));const W=R.get("simulation_status");n.value!==W&&(n.value=W,a.value=W===!0?"运行中":"停止",W===!0?w.info(`设备 ${o.value} 模拟已启动`):w.info(`设备 ${o.value} 模拟已停止`))}catch{}},ee=()=>{X||(X=window.setInterval(G,bt))},te=()=>{X&&(clearInterval(X),X=null)};return _e(()=>{M(),ee()}),He(()=>{te()}),Q(()=>E.name,async R=>{R&&(o.value=R,await M())}),(R,T)=>{const W=Ce,B=Z,oe=fe,me=De,be=we,ce=Fe;return _(),U(ce,{class:"device-container"},{default:l(()=>[e(oe,{class:"nodes",span:24},{default:l(()=>[f.value?P("",!0):(_(),U(pe,{key:0,label:"服务器地址",name:s.value},null,8,["name"])),f.value?P("",!0):(_(),U(pe,{key:1,label:"端口号",name:String(u.value)},null,8,["name"])),f.value?(_(),U(pe,{key:2,label:"串口号",name:v.value||"-"},null,8,["name"])):P("",!0),f.value?(_(),U(pe,{key:3,label:"波特率",name:String(g.value)},null,8,["name"])):P("",!0),e(pe,{label:"通讯类型",name:b.value},null,8,["name"]),e(pe,{label:"设备状态",name:t.value,status:d.value},null,8,["name","status"]),e(B,{class:ye(["button",d.value?"btn-stop":"btn-primary-action"]),onClick:N,disabled:i.value,loading:i.value},hl({default:l(()=>[V("span",null,L(r.value),1)]),_:2},[i.value?void 0:{name:"icon",fn:l(()=>[d.value?(_(),U(W,{key:1,class:"icon"},{default:l(()=>[e(Y(Re))]),_:1})):(_(),U(W,{key:0,class:"icon"},{default:l(()=>[e(Y(Me))]),_:1}))]),key:"0"}]),1032,["class","disabled","loading"]),e(B,{class:"button btn-info",onClick:T[0]||(T[0]=O=>A.value=!0)},{default:l(()=>[e(W,{class:"icon"},{default:l(()=>[e(Y(Sl))]),_:1}),T[3]||(T[3]=V("span",null,"查看报文",-1))]),_:1})]),_:1}),e(oe,{class:"nodes",span:24},{default:l(()=>[e(pe,{label:"模拟状态",name:a.value,status:n.value},null,8,["name","status"]),e(be,{modelValue:S.value,"onUpdate:modelValue":T[1]||(T[1]=O=>S.value=O),placeholder:"模拟方式选择",size:"large",class:"simulation-select"},{default:l(()=>[(_(),F(se,null,Ve(D,O=>e(me,{key:O.value,label:O.label,value:O.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e(B,{class:ye(["button",n.value?"btn-stop":"btn-start"]),onClick:p,disabled:i.value||!d.value},{default:l(()=>[n.value?(_(),U(W,{key:1,class:"icon"},{default:l(()=>[e(Y(Re))]),_:1})):(_(),U(W,{key:0,class:"icon"},{default:l(()=>[e(Y(Me))]),_:1})),V("span",null,L(y.value),1)]),_:1},8,["class","disabled"])]),_:1}),e(dt),e(_t,{modelValue:A.value,"onUpdate:modelValue":T[2]||(T[2]=O=>A.value=O),"device-name":o.value},null,8,["modelValue","device-name"])]),_:1})}}}),Ct=ae(gt,[["__scopeId","data-v-83bfaf52"]]);export{Ct as default};
